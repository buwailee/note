%!TEX root = main.tex
\chapter{环（二）}
\ThisULCornerWallPaper{1}{../Pictures/14.png}

\section{拓扑群及其完备化}

\begin{para}
一个群$G$是拓扑群，如果群上有一个拓扑结构使得群乘法和逆都是连续映射。由于左乘是一个同胚，所以如果$U$是一个开集（闭集），那么$gU=\{gh\,:\,h\in U\}$也是一个开集（闭集）。对应到拓扑矢量空间，如果$U$是一个开集（闭集），那么$a+U=\{a+x\,:\,x\in U\}$也是一个开集（闭集）。

对拓扑群$G$，以及子集$A$, $B$，引入两个记号：$A^{-1}=\{a^{-1}\,:\,a\in A\}$以及$AB=\{ab\,:\,a\in A,\, b\in B\}$. 如果$U$是一个开集（闭集），则$U^{-1}$也是一个开集（闭集）。任取开集$U$，以及子集$A$，由于$AU=\bigcup_{a\in A}aU$，所以$AU$是开集，类似地，$UA$也是开集。

从定义来看，如果$A=A_0\cup A_1$，则$BA=BA_0\cup BA_1$，同样，如果$A=A_0\cap A_1$，则$BA=BA_0\cap BA_1$. 因此至少对于有限交或者有限并来说，乘积是可以分配进去的。如果单位元的一个邻域$U$满足$U^{-1}=U$，这样的开集就被称为对称的。
\end{para}

\begin{lem}
设$U$是单位元的一个邻域，则存在单位元的一个对称邻域$V$使得$V\subset VV\subset U$. 
\end{lem}

\begin{proof}
	由于乘法是连续的，所以存在$e$的邻域$V_1$和$V_2$使得$V_1V_2\subset U$. 令$V=(V_1\cap V_1^{-1})\cap (V_2\cap V_2^{-1})$. 显然这是对称的，并且$VV\subset U$. 由于$e\in V$，所以$V=eV\subset VV\subset U$.
\end{proof}

作为推论，对给定$U$，找一个对称开集$V$使得$V\cdots V\subset U$都是不难的，其中$V$相乘任意正整数次。实际上，对相乘$2^n$次是直接的推论，而对任意正整数$k$，都存在一个$2^n>k$，然后取$V$为$2^n$情况的$V$即可。

\begin{lem}\label{lem:2}
设$A\subset G$是一个拓扑群的一个子集，记$\mathscr{B}$是所有包含单位元$e$的开集构成的集合，则对$A$的闭包$\overline{A}$有等式
\[
	\overline{A}=\bigcap_{U\subset \mathscr{B}}AU=\bigcap_{U\subset \mathscr{B}}\overline{AU}.
\]
\end{lem}

\begin{proof}
	任取$x\in \overline{A}$以及$U\in \mathscr{B}$. 我们有$xU^{-1}$是$x$的一个邻域，于是存在$a\in A\cap x U^{-1}$，记$a=xu^{-1}$，我们有$x=au\in AU$. 于是$\overline{A}\subset \bigcap_{U\subset \mathscr{B}}AU$. 这也给出了一个下面会用到的结论：任取$e$的一个开集$U$，有$\overline{A}\subset AU$.

	反过来，考虑闭集的并$\bigcap_{U\subset \mathscr{B}}\overline{AU}$，这是一个闭集，且有显然的包含关系$\bigcap_{U\subset \mathscr{B}}AU\subset \bigcap_{U\subset \mathscr{B}}\overline{AU}$. 任取$x\in \bigcap_{U\subset \mathscr{B}}\overline{AU}$以及$U\in \mathscr{B}$，由上一个引理，存在$U'\in \mathscr{B}$使得$U'U'\subset U$. 由于$x\in \overline{AU'}\subset AU'U'\subset AU$，所以有$\bigcap_{U\subset \mathscr{B}}\overline{AU}\subset \bigcap_{U\subset \mathscr{B}}AU$. 进而$\bigcap_{U\subset \mathscr{B}}AU=\bigcap_{U\subset \mathscr{B}}\overline{AU}$.

	令$U_x$是$x\in \bigcap_{U\subset \mathscr{B}}AU$的一个邻域，再令$U=U_x^{-1}x$，他是$e$的一个邻域且$x\in AU$. 于是存在$a\in A$使得$a\in xU^{-1}=xx^{-1}U_x=U_x$，这就是在说$A\cap U_x\neq \varnothing$. 假设$x\in G-\overline{A}$，则$x$附近一定有一个邻域$U_x$使得$U_x\subset G-\overline{A}$，这与$A\cap U_x\neq \varnothing$矛盾，所以$x\in \overline{A}$.
\end{proof}

\begin{pro}\label{pro:3}
设$G$是一个拓扑群，如果$\{e\}$是一个闭集，则

\begin{compactenum}
\item $G$中任意单点集是一个闭集，这样的拓扑空间被称为$\mathsf{T}_1$空间。

\item $G$是一个Hausdorff空间，或者被称为$\mathsf{T}_2$空间。

\item $G$是正则Hausdorff空间\footnote{单点集是闭集，且任取一个$x$以及一个不包含$x$的闭集$V$，存在两个不相交的开集$U_x$和$U_V$使得$x\in U_x$, $V\subset U_V$. 换而言之，点与开集是可以用开集分离的。}，或者被称为$\mathsf{T}_3$空间。
\end{compactenum}
\end{pro}

\begin{proof}
	对于第一点，任意一个单点集都是单位元的平移，所以成立。因为$\mu:(x,y)\mapsto x^{-1}y$是连续映射且$\{e\}$闭集，$\Delta=\mu^{-1}(e)\subset G\times G$是闭集，其中$\Delta=\{(x,x):x\in G\}$，利用Hausdorff性的对角线判别法，$G$是一个Hausdorff空间。而一个$\mathsf{T}_1$空间是$\mathsf{T}_3$的，当且仅当对任意的$x$以及他的一个邻域$U$，存在$x$的邻域$V$使得$\overline{V}\subset U$. 由于$x^{-1}U$是$e$的一个邻域，所以存在对称开集$U'$满足$U'\subset U'U'\subset x^{-1}U$. 所以$xU'\subset xx^{-1}U=U$是$x$的一个邻域，满足$\overline{xU'}\subset xU'U'\subset xx^{-1}U=U$.
\end{proof}

脱离上面的命题，下面给出一个分离性条件的直接证明：

\begin{pro}\label{1.16}
设$V$是拓扑群$G$的一个闭子集，而$K$是$G$的一个紧子集，并且$V\cap K=\varnothing$. 那么存在$e$的一个邻域$U$使得$VU\cap KU=\varnothing$.
\end{pro}

由于有限集是紧集，当假设$\{e\}$是闭集的时候，这个命题可以直接推出$\mathsf{T}_3$条件。

\begin{proof}
	假定$K$非空，否则命题显然正确。现在任取$x\in K$，于是$G-V$是一个开集，所以可以找到包含原点的开集$U_x$使得$xU_x\cap V=\varnothing$. 取对称开集$W_x$使得$W_xW_xW_xW_x\subset U_x$，此时$xW_xW_xW_x\subset xU_x$，所以$xW_xW_xW_x\cap V=\varnothing$. 

	任取$y\in xW_xW_x\cap VW_x$，由于$y\in xW_xW_x$，所以$yW_x\subset xW_xW_xW_x$，这意味着$yW_x\cap V=\varnothing$，或者说，任取$a\in W_x$，都有$ya\not\in V$. 另一方面，由于$y\in VW_x$，所以一定存在一个$b\in W_x$和$v\in V$使得$y=vb$成立，反过来，$yb^{-1}=v\in V$，由于$W_x$是对称的，所以$b^{-1}\in W_x$，矛盾。因此$xW_xW_x\cap VW_x=\varnothing$.

	遍历$x$，$xW_x$构成$K$的一个开覆盖，由于$K$是紧集，取一个有限子覆盖，对应于$x_1$, $\cdots$, $x_n\in K$. 令$U=\bigcap_{i=1}^n W_{x_i}$，则
	\[
	KU\subset \bigcup_{i=1}^n {x_i}W_{x_i}U\subset \bigcup_{i=1}^n x_iW_{x_i}W_{x_i}.
	\]
	任取$x_iW_{x_i}W_{x_i}$，由于
	\[
		x_iW_{x_i}W_{x_i}\cap VU=x_iW_{x_i}W_{x_i}\cap \bigcap_{j=1}^n VW_{x_j}=(x_iW_{x_i}W_{x_i}\cap VW_{x_i})\cap \bigcap_{j\neq i}^n VW_{x_j}=\varnothing \cap \bigcap_{j\neq i} VW_{x_j}=\varnothing,
	\]
	所以$KU\cap VU=\varnothing$.
\end{proof}

由于$VU$是一个开集，所以$\overline{KU}$都与$VU$不交，进而与$V$不交。由于有限集都是紧的，取$K=\{e\}$，然后就有$\overline{U}$与$V$不交。所以，任取$e$的一个邻域$W$，有闭集$G-W$，于是存在一个$e$的邻域$U$使得$\overline{U}$与$G-W$不交，或者说$\overline{U}\subset W$.

上面讨论了所有单位元邻域的交，由此产生了分离性的讨论。下面说明，任意一个单位元邻域都可以生成整个含有单位元的连通分支。

\begin{lem}\label{lem:116}
对于连通拓扑群，设$U$是单位元的任意一个邻域，则$G=\bigcup_{n\geq 1}U^n$，其中$U^k=\{g_1\cdots g_k\,:\,g_i\in U,\, 1\leq i \leq k\}$是开集。
\end{lem}

\begin{proof}
令$V=U\cap U^{-1}$，显然$V=V^{-1}\subset U$以及$H=\bigcup_{n\geq 1}V^n\subset \bigcup_{n\geq 1}U^n$，而且$H$还是一个子群。下面我们只要证明$H=\bigcup_{n\geq 1}V^n$既是开的也是闭的，那么连通性自然给出了结论。他是开的，如果$\sigma\in V^k$，那么$\sigma V\in V^{k+1}\subset H$就是他的一个开邻域。他是闭的，因为每一个$\sigma H$都是开的，于是$H=G-\bigcup_{\sigma\notin H}\sigma H$是一个闭集。
\end{proof}

结合上面两点不难看到，因为拓扑群有着代数结构，一般而言，这就使得拓扑群的拓扑结构都来自于其单位元附近的邻域。

举个例子，一个拓扑空间是局部紧的，需要每一点处有一个紧邻域，到了拓扑群，只需要单位元有一个紧邻域。

% \begin{para}
% 一个拓扑空间$X$的拓扑可以由某个度量$d$诱导出来，则这个拓扑空间被称为可度量化的。对一般的拓扑空间$X$，Nagata-Smirnov度量化定理给出了可度量化的等价条件为$X$是$\mathsf{T}_3$且存在可数局部有限基。所谓的可数局部有限基就是说拓扑空间的基是可数个局部有限子族的并。所谓的局部有限族，就是对任意一点$p\in X$，存在一个邻域只与族中的有限个元素相交。

% 到了拓扑群语境，这个条件可以减弱到单位元附近存在局部基，使得他是可数个局部有限子族的并。而$\mathsf{T}_3$可以减弱到$\{e\}$是一个闭集。
% \end{para}

\begin{para}[Cauchy列]
在交换拓扑群上可以谈Cauchy列。由于下面我们谈论的都是交换群，所以这里用加法来表示群运算。其实在拓扑群上也可以谈类似的概念，不过这里就不把问题弄得太一般了。

在拓扑群$G$中，一个Cauchy列是$G$中的一个序列$\{g_1$, $g_2$, $\dots\}$，对每一个$G$中$0$的开邻域$U$，都存在一个正整数$n(U)$使得当$s$, $t>n(U)$时都有$g_s-g_t\in U$. 

称两个列$\{x_i\}$和$\{y_i\}$是等价的（共尾的），如果$x_i-y_i\to 0$. 这显然是一个等价关系。如果一个列收敛，则与他等价的列也收敛，并且有着相同的极限。事实上，给定单位元处的一个开邻域$U$，我们可以找一个对称邻域$V$使得$V\subset V+V\subset U$. 如果$\{x_i\}$收敛于$a$，则存在一个$n(V)$使得$i>n(V)$时一定成立$x_i-a\in V$，同样，由于$x_i-y_i\to 0$，所以存在一个$m(V)$使得$i>m(V)$时一定成立$y_i-x_i\in V$（如有必要，利用一下$V$是对称的），于是当$i>N(U)=\max\{n(V),m(V)\}$时，有
\[
	y_i-a=y_i-x_i+x_i-a\in V+V\subset U.
\]
于是$a$也是$\{y_i\}$的极限。

将这两个定义结合起来，不难看到，与Cauchy列等价的列也是Cauchy列，于是它诱导了所有Cauchy列上的一个等价关系。实际上，任取$0$的邻域$U$，选一个对称邻域$V$使得$V+V+V\subset U$. 设$\{x_n\}$是一个Cauchy列，而$\{y_n\}$与他等价，那么对$W$，我们有一个正整数$N$使得，$i$, $j>N$时成立
\[
	y_i-x_i\in V,\quad x_j-y_j\in V,\quad x_i-x_j\in V,
\]
其中前两个是等价，第三个是Cauchy列的条件，于是
\[
	y_i-y_j=(y_i-x_i)+(x_i-x_j)+(x_j-y_j)\subset V+V+V\subset U.
\]
因此$\{y_n\}$也是一个Cauchy列。

\end{para}

\begin{lem}
	Cauchy列的无穷子列与原列等价，进而也是Cauchy列。
\end{lem}

\begin{proof}
	设$\{x_i\}$是一个Cauchy列，而$\{x_{n_i}\}$是一个无穷子列，其中$n_i$随着$i$严格递增。下面证明$x_{n_i}-x_i\to 0$，这等价于说，任取$0$的一个邻域$U$，存在一个$N$使得$i>N$时候一定有$x_{n_i}-x_{i}\in U$. 事实上，由于$n_i$是选成递增的，所以$n_i\geq i$. 由于$\{x_i\}$是一个Cauchy列，所以存在一个$n(U)$使得$i$, $j>n(U)$时候一定有$x_i-x_j\in U$，取$N=n(U)$，则$i>N$时也有$n_i>N$，于是我们就得到了结论。
\end{proof}

一个简单的推论就是，如果Cauchy列的某个无穷子列收敛，则Cauchy列也收敛。

\begin{para}[完备化]
	设$G$是一个交换拓扑群，而$\hat G$是$G$上所有Cauchy列的等价类，则$\hat G$被称为$G$的完备化。

	不难在$\hat G$上定义出一个交换群结构。Cauchy列$\{x_i\}$和$\{y_i\}$的加法定义为序列$\{x_i+y_i\}$，我们需要验证它也是Cauchy列。实际上，任取$0$的开邻域$U$，找一个对称邻域$V$使得$V\subset V+V\subset U$. 存在一个足够大的$N$使得$i$, $j>N$时有$x_i-x_j\in V$以及$y_i-y_j\in V$成立，此时$(x_i+y_i)-(x_j+y_j)\in V+V\subset U$. 因此$\{x_i+y_i\}$也是一个Cauchy列。

	从$G$到$\hat G$有一个自然的同态$\varphi$，即将$x\in G$变成常序列$\{x$, $x$, $\dots\}$. 但是注意到，这个同态可能不是单的。因为如果存在非零的$a\in\bigcap_{U\subset \mathscr{B}}U$，则$\varphi(x)$与$\varphi(x+a)$诱导的两个Cauchy列是等价的。反过来，不难从Cauchy列等价的定义证明也只有当$\bigcap_{U\subset \mathscr{B}}U=\{0\}$时，$\varphi$才是单同态。回忆Lemma \ref{lem:2}，这就是说$\{0\}=\overline{\{0\}}$或者说$\{0\}$是一个闭集，回忆Proposition \ref{pro:3}，这等价于说$G$是一个Hausdorff空间。

	那么$\varphi$什么时候才是满射呢？注意到，如果$G$中的Cauchy列是收敛的，则他与极限的常序列是等价的，所以如果$G$中的Cauchy列都是收敛的，则$\varphi:G\to \hat{G}$是满的。
\end{para}

\begin{para}
	假设$G$是第一可数的，即在每一点处都有可数局部基，在拓扑群上，只需要在原点处有可数局部基即可。这里我们可以赋予$\hat G$一个拓扑空间结构。这个拓扑空间自然要使得$\varphi$以及$\hat G$上的运算成为连续映射，这点我们慢慢检验。

	首先称序列$\{x_i\}$最终处于$0$的邻域$U$中，如果存在一个$N$使得$n>N$时候一定有$x_n\in U$. 注意，如果一个Cauchy列最终处于$U$中，与他等价的Cauchy列不一定也最终处于$U$中。比如考虑开集$(-1,1)\subset \rr$以及序列$\{1-2^{-n}\}$以及$\{1+(-2)^{-n}\}$，它们显然都是Cauchy列，并且相互等价，但是第二个就并不是最终处于$(-1,1)$中的。

	对$G$中的$0$的任意邻域$U$，定义$\hat U$是$\hat G$中那些等价类中的Cauchy列都最终处于$U$的等价类的集合。注意到，我们选取的等价类中所有的元素都最终处于$U$中，这就避免了$\{1+(-2)^{-n}\}$这种会与“边界”无限接近的序列的存在。

	下面罗列一些性质，它们都是简单的：
	\begin{compactenum}
	\item 如果$U\subset V$，则$\hat U\subset \hat V$.
	\item $\hat{U}\cap \hat{V}=\widehat{U\cap V}$.

	%首先，由第一点，显然$\widehat{U\cap V}\subset \hat{U}\cap \hat{V}$. 反过来，由于$\hat{U}$是所有最终处于$U$中的Cauchy列的等价类的集合，而$\hat{V}$是所有最终处于$V$中的Cauchy列的等价类的集合，于是$\hat{U}\cap \hat{V}$中的Cauchy列都最终处于$U\cap V$中。
	\item $\hat{U}\cup \hat{V}=\widehat{U\cup V}$.
	\item $-\hat{U}=\widehat{-U}$.
	\item $\hat{U}+\hat{V}\subset \widehat{U+V}$.
	\end{compactenum}

	考虑所有形如$\hat{a}+\hat{U}$的集合构成的族，其中$a$跑遍$\hat G$，而$U$跑遍$G$中$0$的开邻域。我们验证这是一个拓扑基，即，我们要检验，如果$(a+\hat{U})\cap (b+\hat{V})\neq \varnothing$，则对$c\in (a+\hat{U})\cap (b+\hat{V})$，一定存在一个$c+\hat{W}\subset (a+\hat{U})\cap (b+\hat{V})$. 而这等价于证明存在一个$\hat{W}$使得
	\[
	\hat{W}\subset (a-c+\hat{U})\cap (b-c+\hat{V})
	\]
	而这只需要对$a-c+\hat{U}$找到$U_0$使得$\hat{U}_0\subset a-c+\hat{U}$，对$b-c+\hat{V}$找到$V_0$，然后取$W=U_0\cap V_0$即可。

	由于$c\in a+\hat{U}$，所以$c-a\in \hat{U}$. 考虑Cauchy列$\{x_i=c_i-a_i\}$是$x=c-a$的一个代表元，由于它最终落于$U$中，所以不妨直接假设它完全就处于$U$中。

	我们下面寻找一个$0$的对称邻域$U_0$，使得对于足够大的$n$，成立$x_n+U_0\subset x_n+U_0+U_0\subset U$. 这样对于最终落在$U_0$中的Cauchy列$\{y_n\}$，对足够大的$n$，一定有
	\[
	y_n+x_n\in x_n+U_0\subset U,
	\]
	如果选取$x$的等价类中其他的序列$\{x'_n\}$，那对于足够大的$n$，有$x'_n-x_n\in U_0$，于是
	\[
	y_n+x'_n=(y_n+x_n)+(x'_n-x_n)\in x_n+U_0+U_0\subset U,
	\]
	因此这是良定的。由于$\{y_n\}$是任取的最终落在$U_0$中的Cauchy列，故$\hat{U_0}+x\subset \hat{U}$或者写作$\hat{U_0}\subset -x+\hat{U}=a-c+\hat{U}$，此即所需。

	注意到，如果存在一个$0$的邻域$U_1$使得对于足够大的$n$一定有$x_n+U_1\subset U$成立，则取$U_0$为使得$U_0\subset U_0+U_0\subset U_1$的对称邻域就满足了上面的要求。最后，我们即要找一个$0$的邻域$U_1$，使得对于足够大的$n$，成立$x_n+U_1\subset U$.

	反证，因为假设了$G$是第一可数的，所以找$0$处的可数局部基，并选出一个严格递减的链$O_1\supset O_2\supset \cdots$使得对于任意的$0$的邻域$V$，存在一个整数$n(V)$使得$i>n(V)$时一定成立$O_i\subset V$. 由于不存在$U_1$使得$x_n+U_1\subset U$对足够大的$n$成立，所以对每一个$O_i$，都存在一个$x_{n_i}$使得$x_{n_i}+O_i\not\subset U$，即存在$y_{i}\not\in U$但$y_i\in x_{n_i}+O_i$. 不妨将$n_i$选成按$i$严格递增的，此时，$y_i-x_{n_i}\in O_i$对每一个$i$都成立。由于$O_i$可以选得任意小，故$y_i-x_{n_i}\to 0$，所以$\{y_i\}$与$\{x_{n_i}\}$等价也就与$\{x_i\}$等价，但$\{y_i\}$最终不处于$U$中。由于$x=c-a\in \hat{U}$，按照$\hat{U}$的定义，$\{y_i\}$处于该等价类中也应该最终处于$U$中。矛盾。
\end{para}

\begin{lem}\label{lem:11}
	假设$G$是第一可数的。对$x\in \hat{G}$以及给定$\hat{U}$，若存在对称邻域$V$使得$V\subset V+V\subset U$使得$x$的一个代表元$\{x_i\}$最终处于$V$中，则$x\in\hat{U}$.
\end{lem}

\begin{proof}
	只要证明与$\{x_i\}$等价的序列都最终处于$U$中即可。设$\{x'_i\}$与之等价，则足够大的$i$，我们有$x'_i-x_i\in V$，所以$x'_i=x_i+x'_i-x_i\in V+V\subset U$. 
\end{proof}

\begin{pro}
	如果交换拓扑群$G$是第一可数的，则其完备化$\hat G$有一个自然的拓扑结构使得它是一个拓扑群，并且使得自然同态$\varphi:G\to \hat G$是一个连续同态。此外，$\varphi(G)$是$\hat{G}$的一个稠密子集。
\end{pro}

当交换拓扑群$G$是第一可数的时候，我们会默认$\hat G$有引理中的这个拓扑群结构。

\begin{proof}
	拓扑结构在上面已经给出。考虑基中的任意一个元素$a+\hat{U}$，关于群的逆运算，它的原像是$-a-\hat{U}=-a+\widehat{-U}$也是一个开集，所以逆运算是连续的。

	然后考虑加法$\mu:\hat G\times \hat G\to \hat G$. 设$a+b\in c+\hat{U}$，存在一个$\hat{V}$使得$a+b+\hat{V}\subset c+\hat{U}$，其中$V$是$0$的一个邻域。然后对$V$找一个对称邻域$W$使得$W\subset W+W\subset V$，于是
	\[
	a+\hat{W}+b+\hat{W}=a+b+\hat{W}+\hat{W}\subset a+b+\widehat{W+W}\subset a+b+\widehat{V}\subset c+\hat{U},
	\]
	所以$\mu^{-1}(c+\hat{U})$是一个开集。

	现在，我们来证明$\varphi^{-1}(a+\hat{U})\subset G$是一个开集。如果是空集，则没什么好证的，否则任取$g\in \varphi^{-1}(a+\hat{U})$，于是$\varphi(g)\in a+\hat{U}$，对它可以找到$0$的一个邻域$V$使得$\varphi(g)+\hat{V}\subset a+\hat{U}$，直接可以计算得到
	\[
	g+V\subset \varphi^{-1}(\varphi(g)+\hat{V})\subset \varphi^{-1}(a+\hat U).
	\]
	所以$\varphi^{-1}(a+\hat U)$是一个开集，进而$\varphi$是一个连续同态。

	最后我们证明，$\varphi(G)$是$\hat{G}$的一个稠密子集。任取$x\in \hat{G}$，只需在$\hat{G}$中找一个序列趋向于$x$. 选定$x$的一个代表元$\{x_i\}$，然后考虑$\hat{G}$中的序列$\{\varphi(x_i)\}$，下面说明它的极限就是$x$，或者说$x-\varphi(x_i)\to 0$. 

	任取$\hat{U}$，我们需要说明对于足够大的$i$，$x-\varphi(x_i)\in \hat{U}$. 取$U$的一个对称邻域$V$使得$V\subset V+V\subset U$，由Lemma \ref{lem:11}，只要$\{x_j-x_i\}_j$最终处于$V$中就得到了$x-\varphi(x_i)\in \hat{U}$. 由于$\{x_i\}$是Cauchy列，所以对$V$，存在$n(V)$，当$i$, $j>n(V)$时，$x_j-x_i\in V$成立。此即所需。
\end{proof}

\begin{para}
	既然$\hat{G}$是一个拓扑群了，我们自然也可以继续谈它的一些拓扑性质。
	\begin{compactenum}
	\item $\hat{G}$是Hausdorff空间。
	\item $\hat{G}$是第一可数的。
	\item $\hat{G}$是完备的，即$\hat{G}$中所有的Cauchy列收敛。
	\item 因此，对$\hat{G}$的完备化$\hat{\hat G}$以及自然同态$\hat\varphi:\hat{G}\to\hat{\hat G}$. 由第一点，$\hat\varphi$是单射，由第三点，$\hat\varphi$是满射，所以$\hat\varphi$是一个同构。
	\end{compactenum}

	\begin{proof}
		对第一点，考虑$x\in \bigcap\hat{U}$，其中$U$跑遍$G$上$0$处的开邻域，我们证明$x=0$，即$x$中的任意代表元都与常序列$\{0$, $0$, $\dots\}$等价，或者说，任取$x$的代表元$\{x_i\}$，都有$x_i\to 0$. 任取$0$的开邻域$U$，因为$x\in \hat{U}$，$\{x_i\}$最终处于$U$中，所以存在一个$N$使得$n>N$时有$x_n\in U$，这就推出了$x_i\to 0$.

		第二点直接来自于$\hat{G}$的拓扑基的构造与$G$第一可数的假设。

		然后证明第三点。因为$G$是第一可数的，所以找$0$处的可数局部基，并选出一个严格递减的链$O_1\supset O_2\supset \cdots$使得对于任意的$0$的邻域$U$，存在一个整数$n(U)$使得$i>n(U)$时一定成立$O_i\subset U$. 

		考虑$\{\hat{x}_i\}_i$是$\hat{G}$中的一个Cauchy列，由于$\varphi(G)$在$\hat{G}$中是稠密，所以$\varphi^{-1}(\hat{x}_i+\hat{O}_i)$非空，让我们取一个$y_i\in\varphi^{-1}(\hat{x}_i+\hat{O}_i)$. 于是$\varphi(y_i)\in \hat{x}_i+\hat{O}_i$或者说$\varphi(y_i)-\hat{x}_i\in \hat{O}_i$，因此$\{\varphi(y_i)\}_i$与$\{\hat{x}_i\}_i$等价，所以只需证明$\{\varphi(y_i)\}_i$收敛。这里先可以得出$\{\varphi(y_i)\}_i$是一个Cauchy列。

		任取开集$U$，由于$\{\varphi(y_i)\}_i$是Cauchy列，所以存在$n(U)$使得$i$, $j>n(U)$时有
		\[
		\varphi(y_i-y_j)=\varphi(y_i)-\varphi(y_j)\in \hat{U},
		\]
		所以$y_i-y_j\in \varphi^{-1}(\hat{U})=U$. 于是$\{y_i\}$是Cauchy列，它在$\hat G$中的等价类记作$y$. 最后，我们证明它就是$\{\varphi(y_i)\}_i$的极限，或者说$\varphi(y_i)-y\to 0$. 与证明稠密性时候相似，利用Lemma \ref{lem:11}和$y$是一个Cauchy列，我们就得到了结论。
	\end{proof}
\end{para}

\section{线性拓扑环}

拓扑环（对加法）当然是一个拓扑群，且乘法是一个连续映射。如果拓扑环在$0$处存在一个一族开理想构成的的拓扑基，则称拓扑环是一个线性拓扑环。

\begin{para}
设$R$是一个\idx{线性拓扑环}，称开理想$\mathfrak{a}$是一个\idx{定义理想}，如果任取一个包含$0$的开集$U$，存在一个正整数$n(U)$使得当$i>n(U)$时都有$\mathfrak{a}^i\subset U$. 换句话说，即$\mathfrak{a}^i\to 0$. 如果一个线性拓扑环具有定义理想，则称其为\idx{预可容的}。预可容拓扑环如果还是分离且完备的，则称其为\idx{可容的}。
\end{para}

如果$\mathfrak{a}$是$R$的一个定义理想，而$\mathfrak{b}$是任意的一个开理想，则开理想$\mathfrak{a}\cap \mathfrak{b}$也是一个定义理想。所以，预可容环的所有定义理想构成$0$处的一个拓扑基。

反过来，如果我们知道了一个定义理想，则我们可以知道其他的定义理想。这表现为如下引理。

\begin{lem}
设$R$是一个预可容环，而$\mathfrak{a}$是一个定义理想。一个开理想$\mathfrak{b}$是一个定义理想，当且仅当存在一个$n$使得$\mathfrak{b}^n\subset \mathfrak{a}$.
\end{lem}

这从定义是显然的。

\begin{pro}设$R$是一个预可容环，而$\mathfrak{a}$是一个定义理想，则以下命题等价：
\begin{compactenum}[~~~(1)]
\item $x^n\to 0$,
\item $x\in \sqrt{\mathfrak{a}}$,
\item $x$属于某个定义理想。
\end{compactenum}
\end{pro}

\begin{proof}可以按如下顺序来证明：
\begin{compactitem}
\item[~~~$(1)\Rightarrow (2)$] 由于$x^n \to 0$，而$\mathfrak{a}$是一个开理想，所以存在一个$N$使得$x^N\in \mathfrak{a}$. 此即$x\in \sqrt{\mathfrak{a}}$.
\item[~~~$(2)\Rightarrow (3)$] 考虑理想$\mathfrak{b}=\mathfrak{a}+\langle x\rangle$，这是一个开理想，因为它作为集合不过是$\bigcup_{r\in R}(rx+\mathfrak{a})$. 由于$x\in \sqrt{\mathfrak{a}}$，所以存在一个$n$使得$x^n \in \mathfrak{a}$. 不难检验$\mathfrak{b}^n\subset \mathfrak{a}$. 所以$\mathfrak{b}$是一个定义理想，且$x\in \mathfrak{b}$.
\item[~~~$(3)\Rightarrow (1)$] 显然。
\end{compactitem}
\end{proof}

\begin{pro}设$R$是一个预可容环，而$\mathfrak{m}$是一个理想，则以下命题等价：
\begin{compactenum}[~~~(1)]
\item $\mm$是$R$最大的定义理想,
\item $\mm$是$R$的一个极大的定义理想,
\item $\mathfrak{m}$是一个定义理想且$\mm=\sqrt{\mm}$,
\item $\mathfrak{m}$是一个定义理想且$R/\mm$是约态环。
\end{compactenum}
\end{pro}

\begin{proof}可以按如下顺序来证明：
\begin{compactitem}
\item[~~~$(1)\Rightarrow (2)$] 显然。
\item[~~~$(2)\Rightarrow (3)$] 如果$\mm\neq\sqrt{\mm}$，则存在一个非零的$x\in \sqrt{\mm}-\mm$和一个$n$使得$x^n\in \mm$. 考虑开理想$\mathfrak{b}=\mathfrak{m}+\langle x\rangle$，他是一个定义理想且真包含$\mathfrak{m}$，这与$\mm$的极大性矛盾。所以$\mm=\sqrt{\mm}$.
\item[~~~$(3)\Rightarrow (1)$] 设$\mathfrak{a}$是任意的一个定义理想，则任取$x\in \mathfrak{a}$都有$x^n\to 0$，所以$x\in \sqrt{\mm}=\mm$，此即$\mathfrak{a}\subset \mm$.
\item[~~~$(3)\Rightarrow (4)$] $\mm=\sqrt{\mm}$等价于$\mm$是一个素理想，所以$R/\mm$是整环当然也是约态的。
\item[~~~$(4)\Rightarrow (2)$] 如果$\mm$不是一个极大的定义理想，则必然有一个定义理想$\mathfrak{a}$真包含它。于是存在非零元$x\in \mathfrak{a}-\mm$使得$x^n\in \mm$. 在商态射下，$x$在$R/\mm$中是非平凡的幂零元，所以$R/\mm$不是约态环。
\end{compactitem}
\end{proof}

如果$R$是一个Noether预可容环，则可知必然存在一个最大的定义理想。

\begin{para}
称一个拓扑环是一个预进制环，如果存在一个定义理想$\mathfrak{a}$使得$\{\mathfrak{a}^n\,:\,n\in \zz\}$是$0$处的一个拓扑基。如果一个预进制环完备且分离，则称这是一个进制环。
\end{para}

\begin{lem}
设$R$是一个预进制环，则对$R$的任意定义理想$\mathfrak{a}$，$\{\mathfrak{a}^n\,:\,n\in \zz\}$是$0$处的一个拓扑基。因此，预进制环由不同定义理想诱导的拓扑都是相同的。
\end{lem}

\begin{proof}
设$\mathfrak{a}_0$是一个定义理想，$\{\mathfrak{a}_0^n\,:\,n\in \zz\}$是$0$处的一个拓扑基。现在考虑定义理想$\mathfrak{a}$，如果开集$a+\mathfrak{a}^m$和开集$b+\mathfrak{a}^n$相交非空，则我们存在一个$c\in (a+\mathfrak{a}^m)\cap (b+\mathfrak{a}^n)$，现在我们只要证明存在一个$\mathfrak{a}^l$使得
\[
	c+\mathfrak{a}^l\subset (a+\mathfrak{a}^m)\cap (b+\mathfrak{a}^n)
\]
即可。等价地，上式可以写成
\[
	\mathfrak{a}^l\subset (a-c+\mathfrak{a}^m)\cap (b-c+\mathfrak{a}^n),
\]
由于$(a-c+\mathfrak{a}^m)\cap (b-c+\mathfrak{a}^n)$是包含$0$的一个开集，所以存在$\mathfrak{a}_0^p$使得
\[
	\mathfrak{a}_0^p\subset (a-c+\mathfrak{a}^m)\cap (b-c+\mathfrak{a}^n).
\]
由于$\mathfrak{a}$是定义理想，所以存在一个$n$使得$\mathfrak{a}^n\subset \mathfrak{a}_0$. 最后，取$l=pn$即可。
\end{proof}

最后，我们以一个不算太有趣的命题结束这节。

\begin{pro}\label{krh}
设$R$是一个可容环，而$\mathfrak{a}$是其定义理想，任取$x\in \mathfrak{a}$，$1+x$总是可逆的。
\end{pro}

\begin{proof}
给定$x\in \mathfrak{a}$，$\sum_{n=0}^\infty (-x)^n$是Cauchy列，由于$R$完备，所以收敛于$y\in R$. 不难计算得到$y(1+x)=1$. 
\end{proof}

如果$\mathfrak{a}$还是极大理想，则从这个命题可以看到$R$是一个局部环。因此，定义理想为极大理想的可容环是局部环。

\section{环的完备化}

环的完备化是最重要的预可容、进制环。

\begin{para}
设$R$是一个环，而$R=\mm_0\supset \mm_1\supset \mm_2\supset \cdots$是一族理想。我们定义$R$关于这族理想的降链的完备化$\hat R$为$R/\mm_i$的极限
\[
\begin{aligned}
	\hat R&:=\varprojlim R/\mm_i\\
	&:=\left\{
	g=(g_1,g_2,\dots)\in \prod_i R/\mm_i\,:\, \text{给定$i$，对所有的$j>i$成立$g_j\equiv g_i$ (mod $\mm_i$)}
	\right\}.
\end{aligned}
\]
显然，$\hat R$是一个环，加法和乘法的定义都是自然的。这个环有自然的理想$\hat \mm_i$
\[
	\hat \mm_i:=\{g=(g_1,g_2,\dots)\in\hat R\,:\, \text{对所有$j\leq i$都有$g_j=0$}\}.
\]
由定义，不难看到$\hat R/\hat \mm_i\cong R/\mm_i$. 进而$\hat{\hat R}\cong \hat R$.

完备化的一个典型应用是取$\mm_i=\mm^i$. 比如整数环$\zz$关于$(p)^i$的完备化$\hat\zz_{(p)}$就是所谓的$p$进制数环。再比如，$R[x]$关于$(x)^i$的完备化是幂级数环$R[\![x]\!]$. 这时候，我们记这类完备化为$\hat R_\mm$.
\end{para}

注意到局部化的等式$S^{-1}(R/\mm_i)=S^{-1}R/S^{-1}\mm_i$，因此局部化与完备化可交换。特别地，$\widehat{R_\mm}\cong \hat{R}_{\hat{\mm}}$.

直观来看，$R=\mm_0\supset \mm_1\supset \mm_2\supset \cdots$是降链，它们将$R$分成了一个一个等价类，而$\mm_i$愈小，则等价类越多，将$R$分得更细。对$g=(g_1,g_2,\dots)$，给定$i$，所有的$g_j$在$R/\mm_i$中看起来都是相同的，其中$j\geq i$，或者说，它们在同一个等价类中。所以$\hat R$中的一个元素，即从大的等价类中再取一个小的等价类，然后越来越细。

\begin{para}
完备化的名字来自于，我们可以给$R$一个拓扑空间结构使得$\hat R$是$R$作为拓扑群（当然也是拓扑环）的完备化。

实际上，取$\{\mm_i\}$为$R$原点处的拓扑基，进而就得到了$R$上的一个拓扑结构。这个拓扑结构的直观是与上面说的相同的，我们把更细的等价类看成了$R$中更小的开集。这也是我们的出发点。这样定义的$R$当然是第一可数的，所以它的完备化总是存在的，我们临时把它记作$\bar{R}$. 

$\bar{R}$作为拓扑群的完备化当然是加法群，而上面乘法的定义也是简单的，如果$a$, $b$是$R$中的两个Cauchy列，定义一个列
\[
	(ab)_i=a_ib_i,
\]
其中$a_i$, $b_i$分别是Cauchy列$a$, $b$第$i$个元。这是一个Cauchy列，实际上，任取$\mm_n$，则对于足够大的$i$, $j$都有$b_j-b_i\in \mm_n$和$a_j-a_i\in \mm_n$，我们有
\[
	a_jb_j-a_ib_i=a_jb_j-a_jb_i+a_jb_i-a_ib_i=a_j(b_j-b_i)+(a_j-a_i)b_i\in \mm_n.
\]

现在，取$\bar{a}$, $\bar{b}\in \bar{R}$，$a$是$\bar{a}$的一个代表元，对应地，$b$是$\bar{b}$的一个代表元。我们定义$\bar{R}$上的乘法为：
\[
	\bar{a}\bar{b}=\overline{ab}.
\]
这个定义是良定的，实际上，如果$a'$, $b'$是其他代表元。则
\[
	a_ib_i-a'_ib'_i=a_ib_i-a'_ib_i+a'_ib_i-a'_ib'_i=(a_i-a'_i)b_i+a'_i(b_i-b'_i)\to 0
\]
所以$ab$和$a'b'$也等价，因此$\overline{ab}=\overline{a'b'}$.
\end{para}

\begin{pro}
	我们两种方法定义的局部化作为拓扑环是同构的，即$\bar{R}\cong \hat R$. $\hat R$的拓扑由$0$处的拓扑基$\{\hat \mm_i\}$给出。
\end{pro}

\begin{proof}
	首先指出$\hat R$中的元素$g$将给出一族等价的Cauchy列。实际上，选取$g_i$在$R$中的原像$p_i$. 给定一个$R$中零的邻域$U$，我们总可以找一个$\mm_i$使得$\mm_i\subset U$. 由$\hat R$的定义，对$j$, $k>i$，都有$p_j-p_i\in \mm_i$以及$p_k-p_i \in \mm_i$，由于$\mm_i$是一个理想，所以$p_j-p_k=(p_j-p_i)-(p_k-p_i)\in \mm_i\subset U$. 这时候取$n(U)=i$即可。于是，$\{p_1$, $p_2$, $\dots\}$是一个Cauchy列。此外，还需证明，如果选取不同原像，将会得到等价的Cauchy列。实际上，如果$q_i$是$g_i$在$R$中选取的其他原像，则$p_i-q_i\in \mm_i$，因此$p_i-q_i\to 0$. 此即所需。这样就得到了映射$\varphi:\hat{R}\to \bar{R}$，它显然是一个环同态。

	反过来，我们证明$R$中每一条Cauchy列可以等价于$\hat R$中某个元素给出的Cauchy列。给定一条$R$中的Cauchy列$\{p_1$, $p_2$, $\dots\}$. 对原点的开邻域$\mm_i$，存在一个正整数$n(\mm_i)$使得$j$, $k>n(\mm_i)$时有$p_j-p_k\in \mm_i$. 为方便起见，将$n(\mm_i)$选为严格递增的，这样$n(\mm_i)\geq i$. 记$n_i=n(\mm_i)+1$，考虑子列$q_i=p_{n_i}$，它是Cauchy列且对每一个$\mm_i$以及$j$, $k>i$，成立$q_j-q_k=p_{n_j}-p_{n_k}$，由于$n_j$, $n_k>n_i=n(\mm_i)+1>n(\mm_i)$，所以
	\[
		q_j-q_k=p_{n_j}-p_{n_k}\in \mm_i,
	\]
	这样我们就可以定义出一个$q\in \hat R$通过$q=(\bar{q}_1$, $\bar{q}_2$, $\dots)$，其中$\bar{q}_i$是$q_i$在$R/\mm_i$中的像。于是$\{q_i\}$就被称为$\{p_i\}$由$\{n_i\}$选取的子序列，他给出了$\hat R$里面的一个元素。这条子序列与原序列等价。

	最后我们要证明，改变选取的$\{n_i\}$或者等价类中不同的序列，都将给出$\hat R$中同一个元素。我们下面依次说明，首先，$q\in \hat R$不依赖于$n(\mm_i)$的选取，其次，如果给出两条等价的Cauchy列，它们会得到$\hat R$中相同的元素。

	第一点，如果选取不同的严格递增的$n(\mm_i)$和$n'(\mm_i)$，得到了$n_i$和$n_i'$，继而有了不同的$q_i$和$q_i'$. 如果$n_i=n_i'$，则$q_i=q_i'$自不必说。如果$n_i\neq n_i'$，由于$q_i-q_i'=p_{n_i}-p_{n_i'}$且$n_i'$, $n_i$或者大于$n(\mm_i)$或者大于$n'(\mm_i)$，则$q_i-q_i'\in \mm_i$，所以它们在$R/\mm_i$有着相同的像，继而得到了同一个$q\in\hat R$.

	第二点，假设有两条等价的Cauchy列$\{p_1$, $p_2$, $\dots\}$和$\{p'_1$, $p'_2$, $\dots\}$，我们证明可以选出一列严格递增的正整数$\{n_i\}$使得子序列$q_i=p_{n_i}$和$q'_i=p'_{n_i}$可以定义$\hat R$中的一个元素，且满足$q_i-q_i'\in \mm_i$. 于是它们在$R/\mm_i$的像就相同了，继而得到了同一个$q\in\hat R$.

	对每一个$\mm_i$，由于$p$和$p'$等价，所以存在一个$m(\mm_i)$使得$j>m(\mm_i)$时一定有$p_j-p'_j\in \mm_i$，然后对$p$和$q'$，可以选出$n(\mm_i)$和$n'(\mm_i)$使得其满足Cauchy列的要求。现在定义$N(\mm_i)=\max\{m(\mm_i)$, $n(\mm_i)$, $n'(\mm_i)\}$以及$n_i=N(\mm_i)+1$. 这样，子列$q_i=p_{n_i}$和$q'_i=p'_{n_i}$就是我们需要的子列。实际上，由于$n_i>N(\mm_i)\geq m(\mm_i)$，所以
	\[
		q_i-q'_i=p_{n_i}-p'_{n_i}\in \mm_i.
	\]
	这样，我们就得到了映射$\psi:\bar{R}\to \hat{R}$，它显然是一个环同态。

	最后，由构造，不难检验$\psi\varphi(g)=g$以及$\varphi\psi(p)=p$. 所以$\hat R$与$\bar R$作为环同构。下面我们检查拓扑结构。

	在$\hat R$上，我们可以以$\{\hat \mm_i\}$为拓扑基得到一个拓扑。另一方面，$\hat R$上，有从$R$完备化得到的拓扑。如果$\hat \mm_i$正是那些等价类中的Cauchy 列都最终处于$\mm_i$的等价类的集合，则从拓扑群完备化那里得到的知识，我们可以确定这两种拓扑是等价的。为此我们首先证明一个小引理：
	取$x\in \hat R$，如果$x$的某个代表元都最终处于$\mm_i$，则$x$的全部代表元都最终处于$\mm_i$.
	
	设$\{x_i\}$最终处于$\mm_i$，而$\{x'_i\}$是$x$的另外一个代表元。由于$\{x_i\}$和$\{x'_i\}$等价，所以当$n$足够大的时候有$x'_n-x_n\in \mm_i$且$x_n\in \mm_i$，所以$x'_n\in \mm_i$也成立。小引理证毕。
		
	利用这个引理，我们可以在Cauchy列的等价类中选一个足够方便的代表元来处理。那么，给出$(0,\dots,0,x_{i+1},\dots)\in \hat{\mm}_i$，则在完备化的两种不同定义的等同下，它对应的序列是完全处于$\mm_i$中的。于是其等价类也完全处于$\mm_i$中。
	反过来，设$\{x_i\}$最终处于$\mm_i$中，由小引理，我们可以假设$\{x_i\}$完全处于$\mm_i$中。对应地，将得到一个元素$(\bar{x}_1,\bar{x}_2,\dots)\in \hat{R}$. 由于当$j\leq i$时候有$\bar{x}_j=0 \in R/\mm_i$，所以$\{x_i\}\in \hat{\mm}_i$. 
		
	综上，$\hat \mm_i$正是那些等价类中的Cauchy 列都最终处于$\mm_i$的等价类的集合。所以$\hat R$从两种定义得到的拓扑也是相同的。
\end{proof}

因此，有了这个同构，我们直接将$\bar R$和$\hat R$等同起来。这个等同提供了许多事情的不同观点。比如，从$R\to \hat R$有一个自然的映射$r\mapsto (r,r,r,\dots)$，很容易看到，这不一定是单的：如果$\bigcap_i \mm_i\neq 0$且$r-s\in \bigcap_i \mm_i$，则$r$与$s$映向$\hat R$中同一个元素。而以拓扑的观点来看，这就是在说$R$是不是一个Hausdorff空间。只有当具有足够分离性时，$\bar R$中的常序列才可能一一对应于$R$中的元素。这并不奇怪，因为众所周知，非Hausdorff空间中同一个序列可能有不同的极限。

通过$R\to \hat R$的自然同态$r\mapsto (r,r,r,\dots)$，我们可以将$\hat R$看成一个$R$-代数。
如果$R\to \hat R$的自然同态是同构，则我们称$R$是（关于理想族$\{\mm_i\}$）\idx{完备}的。如果理想族是$\mm_i=\mm^i$，则称关于理想$\mm$是完备的。显然，$\hat R$是完备的，因为它与$\hat{\hat R}$同构。

\begin{para}
特别地，考虑$\hat R_\mm$，由于$\{\hat \mm^n\}$构成$0$处的一个拓扑基，所以$\hat R_\mm$是一个预进制环。由于$\hat R$还是完备且分离的，所以也是一个进制环。
\end{para}

% \para 我们下面将形式地处理级数，尽管上面给出了一个拓扑。在$\prod_{i=0}^\infty \mm_i$上，考虑如下等价关系：$(x_0$, $x_1$, $\dots)\sim (y_0$, $y_1$, $\dots)$，如果对每一个$n\geq 1$都有
% \[
% 	\sum_{i=0}^{n-1} (x_i-y_i)\in \mm_n.
% \]
% 不难看到这是一个等价关系。将$(x_0$, $x_1$, $\dots)$在$\prod_{i=0}^\infty \mm_i\,\big/\!\sim$中的像（即等价类）记作（形式）级数$\sum_{i=0}^\infty x_i$. 同样，可以定义级数对应的$R$中的部分和序列$\{X_n=\sum_{i=0}^{n-1} x_i\,:\, n\geq 1\}$，并且约定$X_0=0$.  虽然级数不同代表元的选取会对应有不同的部分和，但是对$X_n$而言，不过至多相差一个$\mm_n$中的元素，因为等价关系
% \[
% 	\sum_{i=0}^{n-1} (x_i-y_i)\in \mm_n
% \]
% 不过是在说$X_n-Y_n\in \mm_n$. 

% 给定一个级数$\sum_{i=0}^\infty x_i$，其部分和序列虽不唯一，但却给出了唯一的$(\bar{X}_1$, $\bar{X}_2$, $\dots)\in \hat{R}$，其中$\bar{X}_n$为$X_n$在$R/\mm_n$中的像。反过来，取顶$\hat R$中的元素$g$，对每一个$g_i\in R/\mm_i$找一个$R$中的原像$x_i$，定义$x'_0=x_1\in R=\mm_{0}$以及定义$x'_i=x_{i+1}-x_{i}\in \mm_{i}$，不难看出，级数$\sum_{i=0}^\infty x'_i$的部分和$\sum_{i=0}^{n-1} x'_i$就是$\{x_i\,:\,i\geq 1\}$. 所以$\hat R$都确定了一个级数$\sum_{i=0}^\infty x'_i$，其中$x'_i\in \mm_{i}$. 而且这个级数还是唯一的，因为选取不同的原像，部分和$X'_n=x_n$不过就差一个$\mm_n$中的元素而已。

% 因此，我们建立了$\hat R$中的元素与级数$\sum_{i=0}^\infty x_i$的一一对应，其中$x_i\in\mm_{i}$. 所以我们将就级数的和取作$\hat R$中的元素。作为这个等同的应用，此时$\hat\mm_n$是所有形如$\sum_{i=n}^\infty x_i$的级数，其中$x_i\in\mm_i$. 再比如，$\hat R$此时的$R$-模乘法就是
% \[
% 	r\sum_{i=0}^nx_i=\sum_{i=0}^n rx_i.
% \]

% \para 两个级数的和是$\sum_i x_i+\sum_i y_i =\sum_i(x_i+y_i)$。乘法会复杂些，但还是挺自然的，记$\sum_i x_i$和$\sum_i y_i$的部分和分别是$\{X_i\}$与$\{Y_i\}$，则$\hat R$上的乘法翻译作
% \[
% 	\left(\sum_{i=0}^\infty x_i\right)\left(\sum_{i=0}^\infty y_i\right)=\sum_{n=0}^\infty (X_{i+1}Y_{i+1}-X_{i}Y_i)=\sum_{i=0}^\infty (x_iy_i+x_iY_i+y_iX_i).
% \]
% 一般而言，这个乘法并不方便，但是当$\mm_i\mm_j\subset \mm_{i+j}$时，由于$x_i\in\mm_{i}$以及$y_j\in\mm_{j}$，所以$x_iy_i\in \mm_{i+j}$，此时$\sum_{i+j=n}x_iy_j\in \mm_n$，不难证明此时的乘法就可以写作
% \[
% 	\left(\sum_{i=0}^\infty x_i\right)\left(\sum_{i=0}^\infty y_i\right)=\sum_{n=0}^\infty \sum_{i+j=n}x_iy_j.
% \]
% 实际上，我们只要证明
% \[
% 	\sum_{i=0}^{n-1} (x_iy_i+x_iY_i+y_iX_i)-\sum_{k=0}^{n-1} \sum_{i+j=k}x_iy_j\in \mm_n
% \]
% 即可，这是直接的计算。

% 这种情况的例子是很常见的，比如$\mm_i=\mm^i$. 作为上述乘法的例子，我们验证，如果$h\in\mm$，则$1-h$在$\hat{R}_\mm$中有逆$\sum_{i=0}^\infty h^i$，因为
% \[
% 	(1-h)\sum_{i=0}^\infty h^i=1+\sum_{n=1}^\infty(1-1)=1.
% \]
% 如果$R$是关于$\mm$是完备的，则$1-h$在$R$中也可逆的。

% \para 这里来谈谈级数的重排。首先引入一个说法，如果$a\in \mm_{n}$但$a\not\in\mm_{n+1}$，则称$a$的阶数为$n$. $R$中每一个元素都有一个固定的阶数。

% 现在考虑这样一种情况，$x_i$的阶数为$i+d_i$，其中$d_i\geq 0$，而$y_i$是所有阶数为$i$的$x_j$的和，由于$x_j$的阶数总不小于$j$，所以$y_i$的求和项中$x_j$的$j$总不大于$i$，因此这个求和总是有限的。此时对每一个$n$，我们总有
% \[
% 	\sum_{i=0}^{n-1} (x_i-y_i)=\sum_{i=0}^{n-1} x_i-\sum_{i=0}^{n-1} y_i\in \mm_n,
% \]
% 这也是直接的计算，不过可以直接注意到$\sum_{i=0}^{n-1} y_i$即是所有阶数小于$n$的$x_j$的和，因此$\sum_{i=0}^{n-1} x_i$减去它后剩下的项阶数都应该不小于$n$.

% 这就意味着，在级数计算中，“高阶项”可以出现在低阶位置（指第$n$个位置处出现的加项阶数高于$n$），如果我们把他移到其他合理的位置（即不高于其阶数的位置），级数的值依然不变，都等于那种最合理的方式（即$k$-阶项就出现在第$k$个位置求和）。这种意义上，我们允许级数的部分重排。

% 举个例子，对级数$\sum_{i=0}^\infty x_i$，如果$x_i\in \mm_{i+d}$其中$d$是一个正整数，则
% \[
% 	\sum_{i=0}^\infty x_i=\sum_{i=d}^\infty x_{i-d}.
% \]

% \para 利用级数记号，我们来观察典范同构$\hat{\hat R}\cong \hat{R}$. 首先，$\hat R/\hat \mm_n$中的元素都可以写成$\sum_{i=0}^{n-1}x_i$在$R/\mm_n$中的像。这就是典范同构$\hat R/\hat \mm_n \to R/\mm_n$在级数记号下的等同。

% 利用级数，$\hat{\hat R}$中的元素可以写成$\sum_{i=0}^\infty x_i$，而$x_i\in \hat \mm_i$，因此$x_i=\sum_{j\geq i}y_{ij}$，其中$y_{ij}\in \mm_j$. 将其还原成
% \[
% 	\sum_{i=0}^nx_i=(\bar{x}_0,\bar{x}_0+\bar{x}_1,\bar{x}_0+\bar{x}_1+\bar{x}_2,\dots),
% \]
% 利用等同，此时第$n$项$\sum_{i=0}^{n-1}\bar{x}_i$是$\sum_{i=0}^{n-1}\sum_{j=i}^{n-1} \bar{y}_{ij}$，其中$\bar{y}_{ij}\in R/\mm_n$. 换而言之，典范同构$\hat{\hat R}\cong \hat{R}$在这里即
% \[
% 	(\bar{x}_0,\bar{x}_0+\bar{x}_1,\bar{x}_0+\bar{x}_1+\bar{x}_2,\dots)\leftrightarrow\left(\bar{y}_{00},\bar{y}_{00}+\bar{y}_{01}+\bar{y}_{11},\dots,\sum_{i=0}^{n-1}\sum_{j=i}^{n-1} \bar{y}_{ij},\dots\right),
% \]
% 在这里，符号上，对应于第$R/\mm_n$位置处的$\bar{y}_{ij}$是$y_{ij}$在$R/\mm_n$中的像。注意到恒等式
% \[
% 	\sum_{j=0}^{n-1}\sum_{i=0}^{j} \bar{y}_{ij}=\sum_{i=0}^{n-1}\sum_{j=i}^{n-1} \bar{y}_{ij},
% \]
% 所以如果用级数来表述典范同构给出的等同，他就写作
% \[
% 	\sum_{i=0}^\infty \sum_{j=i}^\infty y_{ij}=\sum_{j=0}^\infty \sum_{i=0}^jy_{ij},
% \]
% 其中$y_{ij}\in \mm_j$. 注意到，等式左边是在$\hat{\hat R}$中，而右边是在$\hat R$中。

% 反过来，任取$\sum_{i=0}^\infty x_i\in \hat{R}$，其中$x_i\in \mm_0$，则我们可以将其看成$\sum_{j=0}^\infty y_j$，其中$y_0=\sum_{i=0}^\infty x_i$，而对$j\neq 0$，$y_j=0$. 这显然是一个单射，因为很清楚$\bigcap_{i=0}^\infty \hat{\mm}_i =\{0\}$. 用级数来看，$\sum_{i=0}^\infty x_i \in \hat{\mm}_n$意味着它前$n$项部分和处于$\mm_n$中，而现在$n$是任意的，所以$\sum_{i=0}^\infty x_i=0$.

\begin{pro}
如果$\mm$是$R$的一个极大理想，则$\hat R_\mm$是一个局部环，极大理想为$\hat\mm$.
\end{pro}

\begin{proof}
	首先由$\hat R_\mm/\hat\mm\cong R/\mm$，可以得到定义理想$\hat \mm$是一个极大理想。而Proposition \ref{krh} 告诉我们，定义理想是极大理想的可容环是局部环。
\end{proof}

\begin{pro}
	设$R$是一个环，而$0\to A_n \to B_n \to C_n \to 0$是一族$R$-模正和列，则其极限有正和列
	\[
		0\to \varprojlim A_n\to \varprojlim B_n\to \varprojlim C_n.
	\]
	此外，若$\{A_n\}$, $\{B_n\}$和$\{C_n\}$都是$\cdots \to n-1 \to  n\to n+1\to \cdots$-图，
	且存在$n_0$使得$n>n_0$时，$A_{n+1}\to A_n$都是满射，则上式还进一步成为短正和列。
\end{pro}

\begin{proof}
	第一点来自于极限与核的可交换性（更广义地，极限与极限的可交换性）。对第二点，不失一般性，可以假设$n_0=0$且$A_n$是$B_n$的子模。
	同时，记态射$B_{n+1}\to B_n$为$\pi_n$.
	设序列$(c_n)\in \varprojlim C_n$，对每个$c_n$，随便选一个$B_n$中的原像$b_n$，我们有$a_n=\pi_n(b_{n+1})-b_n\in A_n$，进而存在一个$a_{n+1}\in A_{n+1}$使得$\pi_n(a_{n+1})=a_n$. 所以，我们有
	$b_n=\pi_n(b_{n+1})-a_n=\pi_n(b_{n+1}-a_{n+1})$. 于是我们重新定义$b_{n+1}$为$b_{n+1}-a_{n+1}$，则此时我们构造了一个序列$(b_n)$使得对任意的$n>0$都有$\pi_n(b_{n+1})=b_n$. 进而$(b_n)\in \varprojlim B_n$为$(c_n)$的原像。
\end{proof}

\section{赋值环}

\begin{para}[赋值环]
令$R$是一个整环，$k$是它的分式域。称$R$是$k$的一个赋值环，如果任取非零$x\in k$，有$x$和$x^{-1}$中至少有一个属于$R$。此外，如果$R$还是一个Noether环，则$R$被称为一个离散赋值环，有时候会简单记作DVR. 在后面我们会解释离散赋值环名字的由来。
\end{para}

$k$自然是$k$的一个赋值环，这样的赋值环我们称为平凡赋值环。

\begin{pro}
	赋值环是局部环。	
\end{pro}

\begin{proof} 
	实际上，考虑所有$R$中不可逆元构成的集合$\mathfrak{m}$. 我们可以证明这是一个理想，任取$r\in R$，以及$a\in\mathfrak{m}$，如果$a=0$，则$ra=0\in \mathfrak{m}$，如果$ra\not\in R$或者说$(ra)^{-1}\in R$，则$a^{-1}=r(ra)^{-1}\in R$，这与$a$不可逆矛盾，所以$ra\in R$. 但如果$ra$可逆，则依然是$a^{-1}=r(ra)^{-1}\in R$给出$a$可逆，矛盾，所以$ra\in \mathfrak{m}$. 最后只要检验加法即可。如果$x$, $y\in\mathfrak{m}$，不妨设$y\neq 0$，所以$y^{-1}\in R$以及$xy^{-1}\in R$. 此时$x+y=(xy^{-1}+1)y$，由于$(xy^{-1}+1)\in R$以及$y\in\mathfrak{m}$，所以$x+y=(xy^{-1}+1)y\in \mathfrak{m}$.
\end{proof}

\para 一旦给出一个$k$的赋值环$R$，那么我们可以给出一族赋值环：设整环$R'$满足$R\subset R'\subset k$，则$R'$也是域$k$的一个赋值环。这是简单的，作为$k$的子环，$R'$是整环，在$R\subset R'\subset k$上取三个整环的分式域，可知$k$是$R'$的分式域。任取非零$x\in k$，或者$x\in R'$，如果不，则$x\not\in R$，于是$x^{-1}\in R\subset R'$. 

\begin{pro}
设$R$是$k$的一个赋值环，则他是$k$中的整闭整环。
\end{pro}

\begin{proof}
	设$x\in k$在$R$上整，于是我们有一个首一多项式方程
	\[
		x^n+r_1x^{n-1}+\cdots+r_n=0,
	\]
	其中$r_i\in R$. 如果$x\in R$，自然无需证明，否则$x^{-1}\in R$，于是
	\[
		x=-(b_1+b_2x^{-1}+\cdots+b_n x^{1-n})\in R.\qedhere
	\]
\end{proof}

\begin{pro}
对任意的一个域$k$，存在一个非平凡的赋值环$R$.
\end{pro}

\begin{proof}
	设$K$是$k$的一个代数闭域。设$R$是$k$的一个真子环，而$f:R\to K$是一个环同态。偶对$(R,f)$之间可以定义如下偏序，即$(R,f)\leq (R',f')$当且仅当$R\subset R'$且$f'|_R=f$.

	考虑任意一条链$(R_1,f_1)\leq (R_2,f_2)\leq \cdots$，则$\bigcup_i R_i$是一个$k$的子环。包含于$k$是简单的，现在任取$x$, $y\in \bigcup_i R_i$，则必然存在一个正整数$n$使得$x$, $y\in R_n$，所以$x+y$, $xy\in R_n\subset \bigcup_i R_i$. 同样，我们可以定义一个同态$f:\bigcup_i R_i\to \Omega$：如果$x\in R_n$，则$f(x)=f_n(x)$. 可以看到，这个定义与$n$无关，所以是良定的，此时$(\bigcup_i R_i,f)$就是链$(R_1,f_1)\leq (R_2,f_2)\leq \cdots$的一个上界。同时，由于$(0)$是一个真子环，以及一个自然的包含，所以由Zorn引理，存在一个极大元$(R,g)$.

	下面证明$R$就是一个赋值环。

	首先$g(R)$作为域的子环是整环，由同构基本定义$g(R)\cong R/\ker(g)$，所以$\mathfrak{m}=\ker (g)$是一个素理想。将$R$对$\mathfrak{m}$进行局部化得到$R_\mathfrak{m}$. 我们可以通过$g'(r/s)=g(r)/g(s)$定义出一个同态$g':R_\mathfrak{m}\to K$，满足$g'|_R=g$，由极大性，$R=R_\mathfrak{m}$，所以$R$是一个局部环，$\mathfrak{m}$是它唯一的极大理想。\notprove
\end{proof}

\begin{pro}
设$R$是一个整环，$k$是他的分式域，则$R$是$k$的赋值环的充分必要条件为：任取$\mathfrak{a}$, $\mathfrak{b}$为两个$R$的理想，有$\mathfrak{a}\subset \mathfrak{b}$或者$\mathfrak{b}\subset \mathfrak{a}$. 
\end{pro}

这个命题给出了赋值环的理想结构的一个刻画，如果将理想们按照包含给一个偏序，这个命题就是说，整环$R$是一个赋值环，当且仅当它的所有理想构成的偏序集是全序的。

\begin{proof}
	如果存在两个理想$\mathfrak{a}$和$\mathfrak{b}$，但$\mathfrak{a}\subset \mathfrak{b}$和$\mathfrak{b}\subset \mathfrak{a}$都不成立，即存在$x\in \mathfrak{a}$和$y\in \mathfrak{b}$满足$x\not\in \mathfrak{b}$且$y\not\in \mathfrak{a}$. 假设$R$是一个赋值环，如果$x/y\in R$，则$x=y(x/y)\in \mathfrak{b}$，矛盾，所以$y/x=(x/y)^{-1}\in R$，则$y=x(y/x)\in\mathfrak{a}$，矛盾。所以$R$不是赋值环。逆否就得到了，如果$R$是一个赋值环，则$\mathfrak{a}\subset \mathfrak{b}$或者$\mathfrak{b}\subset \mathfrak{a}$.

	反过来，假设任取两个理想$\mathfrak{a}$和$\mathfrak{b}$，成立$\mathfrak{a}\subset \mathfrak{b}$或者$\mathfrak{b}\subset \mathfrak{a}$. 设$x/y\in k$，其中$x$, $y\in R$. 记$\mathfrak{a}=(x)$以及$\mathfrak{b}=(y)$，于是$x\in (y)$或者$y\in (x)$. 对于前者，$x=ay$，所以$x/y=ay/y=a\in R$. 对于后者，$y=bx$，所以$x/y=x/(bx)=1/b$，或者说$(x/y)^{-1}=b\in R$. 因此$R$是一个赋值环。
\end{proof}

作为推论，如果$R$是一个赋值环，而$\mathfrak{p}$是它的一个素理想。则$R/\mathfrak{p}$以及$R_{\mathfrak{p}}$都是赋值环，整环是清楚的，而赋值环的判断只要看理想的结构即可，$R/\mathfrak{p}$的理想一一对应着$R$中包含$\mathfrak{p}$的理想，而$R_{\mathfrak{p}}$的理想一一对应着$R$的包含于$\mathfrak{p}$的理想。

\para[赋值群] 设$R$是一个赋值环，分式域为$k$，记$k^*=k-\{0\}$，而$U$是$R$中所有可逆元构成的集合。显然$U$是$k^*$的一个子群，进而可以定义商群$\Gamma=k^*/U$. 这被称为赋值群。

在商群$\Gamma$上可以定义偏序，记$\bar{x}$是$x\in k^*$在$\Gamma$中的像，定义$\bar{x}\leq \bar{y}$当且仅当$x^{-1}y\in R$，这自然是良定的，选取不同的代表元，不过就是在$x^{-1}y$上乘以一个$R$中的可逆元而已。这是一个全序，实际上，如果$x^{-1}y\not\in R$，则$yx^{-1}\in R$，反之亦然。更进一步，这个全序还与群结构相容，即$\bar{x}\leq \bar{y}$可以推出，对任意的$\bar{z}$都有$\bar{x}\bar{z}\leq \bar{y}\bar{z}$. 这就意味着，两边是可以消去同一个因子却不改变偏序。正如在$\zz$上，$m\leq n$可以推出$m+p\leq n+p$. 一个具有全序的交换群，如果全序与群结构相容，则称这是全序交换群。称商同态$v:k^*\to\Gamma$为赋值映射，赋的值就是一个全序交换群里面的元素。按照一般习惯，交换群$\Gamma$中的乘法最好写成加法，于是$v(xy)=v(x)+v(y)$. 按照这个记号，任取$x\in R$，我们有$v(x)=v(1x)=v(x)+v(1)$，所以$v(1)=0$. 同样，由于$1^{-1}x\in R$，所以$v(x)\geq v(1)=0$. 这意味着$R$中的元素赋值都是非负的。

此外，$v(x+y)\geq \min\left(v(x),v(y)\right)$. 不妨设$v(x)\leq v(y)$，那就是要证明$v(x+y)\geq v(x)$. 由于$v(x)\leq v(y)$，于是$x^{-1}y\in R$以及$1+x^{-1}y\in R$，所以
\[
	v(x+y)=v(x(1+x^{-1}y))=v(x)+v(1+x^{-1}y)\geq v(x).
\]

\para 反过来，设$G$是一个全序交换群，群同态$v:k^*\to G$如果$v(x+y)\geq \min\left(v(x),v(y)\right)$对任意的$x$, $y\in k^*$都成立，则它是一个赋值映射，它将如下定义$k$的一个赋值环：记$R=\{x\in k^* \,:\, v(x)\geq 0\}\cup \{0\}$，则$R$是$k$的一个赋值环。实际上，由于$v(1)=v(1\cdot 1)=v(1)+v(1)$，所以$v(1)=0$. 类似地，$0=v(1)=v(xx^{-1})=v(x)+v(x^{-1})$，所以，如果$v(x)\leq 0$，则$v(x^{-1})=-v(x)\geq 0$. 

由于赋值环一定是局部环，从赋值映射的角度来看，极大理想就是$R-v^{-1}(0)$. 理由是简单的，如果$x\in R$是可逆的，则$v(x)\geq 0$和$v(x^{-1})\geq 0$同时成立，这就意味着$v(x)=0$. 所以$R-v^{-1}(0)$就是$R$中所有不可逆元的集合，理想结构的验证从赋值映射的性质来看是简单的。

\begin{pro}
一个赋值环是离散赋值环当且仅当它的赋值群是整数群$\zz$. 
\end{pro}

这是离散赋值环名称的由来。
在离散赋值环上，添加$v(0)=+\infty$往往是方便的，记$(n,+\infty]=\{m\in \zz\,:\, m>n\}\cup \{+\infty\}$，则离散赋值环的极大理想就写作$v^{-1}\left((0,+\infty]\right)$. 

\begin{proof}
	假设一个赋值环$R$是离散赋值环，即是Noether环。考虑$R$的所有非平凡主理想，它们也是全序的，由于$R$是Noether环，所以存在一个极大非平凡主理想$(a)$使得其他非平凡主理想$(x)$都满足$(x)\subset (a)$. 这也意味着，所有不可逆元$x$都属于$(a)$，或者说$(a)$就是赋值环的那个极大理想。

	取定不可逆元$x$，他一定可以写成$x=ra^n$的形式。实际上，如果对每一个正整数$n$，都存在不可逆元$r_n\in R$使得$x=r_na^n$成立，则$r_{n+1}a^{n+1}=r_n a^n$和$R$是一个整环可以推出，$r_n = r_{n+1}a$，所以$(r_n)\subset r_{n+1}$. 于是我们就得到了一个升链
	\[
	(r_1)\subset (r_2)\subset \cdots \subset (r_n)\subset \cdots,
	\]
	由于$R$是Noether环，所以一定存在一个正整数$N$使得$(r_N)=(r_{N+1})$，因此存在$b\in R$使得$br_N=r_{N+1}$，但是由于$r_N=ar_{N+1}$，所以$r_N=abr_N$，由整环的消去律，就得到了$ab=1$，这与$a$不可逆矛盾。

	记$x=ra^n$，其中$r$可逆。在$\Gamma$中$\bar{x}=\bar{r}\bar{a}^n=\bar{a}^n$，或者$\bar{x}=1/(\bar{r}\bar{a}^n)=\bar{a}^{-n}$，这样我们就得到了$\Gamma=\{\bar{a}^n\,:\, n\in \zz\}\cong \zz$.

	反过来，设有一个赋值映射$v:k^*\to \zz$. 如果$x$, $y\in R$满足$v(x)=v(y)$，于是$v(xy^{-1})=v(x)-v(y)=0$，所以$xy^{-1}$可逆。由于$x=(xy^{-1})y$，所以$(x)=(y)$. 这也意味着，如果有一个真理想$\mathfrak{a}$以及$x\in \mathfrak{a}$，则所有与$x$具有相同赋值的$y\in R$也都在$\mathfrak{a}$中，因为$(y)=(x)\subset \mathfrak{a}$.

	设$\mathfrak{a}$是$R$的一个真理想，记$n(\mathfrak{a})=\min_{x\in \mathfrak{a}}v(x)$. 由于是真理想，所以$\mathfrak{a}$中元素都是不可逆的，所以$n(\mathfrak{a})>0$. 由上面的推理，$\mathfrak{a}=v^{-1}\left((n(\mathfrak{a})-1,\infty]\right)$. 因此$\mathfrak{a}$中所有的非平凡理想都具有$\mathfrak{a}_n=v^{-1}\left((n,\infty]\right)$的形式，其中$n$是一个非负整数。因为在$v^{-1}\left((n,\infty]\right)$中必然有一个$x$使得$v(x)=n+1$，此时$v^{-1}\left((n,\infty]\right)=(x)$. 所以每一个$v^{-1}\left((n,\infty]\right)$都是主理想，记作$(a_n)$. 所以将$R$中所有理想排出来得到如下严格降链：
	\[
		(a_0)\supset (a_1) \supset (a_2)\supset \cdots,
	\]
	进而，环$R$是Noether环。
\end{proof}

从证明中，我们还可以看到，离散赋值环是一个PID，所以也自然是UFD.

\section{主理想定理}