\chapter{线性代数}
\ThisULCornerWallPaper{1}{../Pictures/3.png}
\section{矢量空间与张量代数}

\begin{para}[矢量空间]
   若$k$是一个域，则称$k$-模为$k$-矢量空间。
\end{para}

如果一个$k$-矢量空间是有限生成的，则我们已经知道他一定是有限长模，其长度就被定义为其维度，但一般来说，我们通常采用基的预言来刻画维度。

\begin{pro}
    设$V$是一个$k$-矢量空间，$X$是其子集，如果存在有限个$\{x_i\}\subset X$以及$k_i\in k$使得$\sum_i k_ix_i=0$，则称$X$是线性相关的，否则则是线性无关的，则以下命题等价：
    \begin{compactenum}
        \item $X$是极大线性无关子集；
        \item $X$是$V$的一个极小生成集；
        \item $V$中任意元素都可以表为有限和$\sum_{x\in X}k_x x$，其中只有有限个$k_x$非零。
    \end{compactenum}
    所以满足这些性质的子集被我们称为$V$的一组基，里面的元素叫做基矢量；并且不难看到，一旦给定一个基$X$，则$V\cong \oplus_{x\in X}k$. 所以，$\dim V=|X|$.
\end{pro}

这个命题的证明是标准的。并且，给定一个线性无关子集，考虑所有包含其的线性无关子集，他们的并也是线性无关的，于是利用Zorn引理，我们可以断言线性无关子集一定包含于一组基中，特别地，基存在。已经看到，对于有限维的矢量空间，每个基的元素个数都是相同的，因为他们都等于维度。下面我们给一个独立的证明。

\begin{pro}
设$X$和$Y$都是$V$的基，且都有限，对于$y\in Y-X$，则存在$x\in X-Y$使得$(Y-\{y\})\cup \{x\}$是一组基。特别地，每个基的元素个数都相等。
\end{pro}

\begin{proof}
对于每个$x\in X$，他们都可以用$Y$中的元素线性展开，由于$Y$是基，则一定存在一个$x$的展开式中$y$的系数不为零，这个$x$就是我们要的那个，检查是直接的。现在，假设$X$, $Y$都是基，且我们选得使得$|Y|>|X|$且$|Y-X|$尽可能小。由于$|Y-X|\neq 0$，所以可以选$y\in Y-X$和$x\in X-Y$使得$Y'=(Y-\{y\})\cup \{x\}$也是一组基，且$|Y'|=|Y|>|X|$，但$|Y'-X|<|Y-X|$，这和我们的选取矛盾。
\end{proof}

\section{本征值问题}

模论的方法给了我们研究线性代数的新思路。考虑一个非零$k$-矢量空间$V$，以及一个线性映射$A:V\to V$. 那么，我们可以通过$x\cdot v=Av$定义$V$的一个$k[x]$-模结构。此时，研究线性映射$A$，也就归结到了研究作为$k[x]$-模的$V$，即研究$k[x]$-模的标量作用。

此外，在有些命题中，$V$需要是一个有限维$k$-矢量空间，不难看到它此时是有限生成$k[x]$-模。反过来并不正确。所以有时候，条件可以放宽到有限生成$k[x]$-模，但有时候就只能放在有限维$k$-矢量空间上。

在标量作用中，零因子（生成的理想）是比较简单和重要的研究对象，从准素分解那里可以看到，associated primes是一类研究比较深入的对象。而将associated primes放到$k[x]$-模$V$上，我们自然就遇到了本征值问题。

\begin{para}[本征值与本征矢量]
    设$A:V\to V$是一个线性映射，在其对应的$k[x]$-模$V$中，如果$\langle x-a\rangle\in \Ass_{k[x]}(V)$，则称$a$为$A$的一个本征值，而对应的$\ann(v)=\langle x-a\rangle$中的$v$被称为本征值$a$对应的本征矢量。
\end{para}

如果$v$是本征值$a$对应的本征矢量，则$(x-a)v=0$等价于$Av=av$. 这就是经典的本征方程。

\begin{para}[本征空间]
    如果$a\in k$是线性映射$A:V\to V$的本征值，则所有以$a$为本征矢量的$v\in V$以及$0$构成了$V$的一个子空间，他被称为$A$的对应于本征值$a$的本征空间。

    显然，如果$v$, $w$的本征值为$a$，则$rv+sw\neq 0$的本征值也为$a$，所以定义合理。并且，从定义，不难看到$V$的本征空间是$V$的一个$k[x]$-子模。
\end{para}

\begin{lem}
    如果$V$是有限维$k$-矢量空间，则首一多项式$\det(xI-A)\in \ann_{k[x]}(V)$.
\end{lem}

\begin{proof}
    参见Hamilton-Cayley定理Theorem \ref{Hamilton-Cayley} 的证明。
\end{proof}

注意到，$k[x]$是PID，则$\ann_{k[x]}(V)$由某个多项式生成，我们将其中的那个首一多项式称为极小多项式，记作$p(V)$，而首一多项式$\det(xI-A)$称为本征多项式，不难看到，本征多项式的次数为$\dim V$.

\begin{pro}
    如果$k$是代数闭域，而$V$是$k$-矢量空间，$A:V\to V$是线性映射，如果对应的$\ann_{k[x]}(V)$是非零理想，则$A$存在本征值。特别地，如果$V$是有限维的，则任意线性映射$A:V\to V$都存在本征值。
\end{pro}

\begin{proof}
    因为$k[x]$总是Noether环，所以associated prime一定存在，同时，因为所有的associated prime一定包含$\ann_{k[x]}(V)$，所以它们是非零素理想。因为$k$是代数闭的，所以只能具有形式$\langle x-a\rangle$，此时$a$就是一个本征值。后一论断结合上一个引理是直接的。
\end{proof}

当然，对于非代数闭域，associated primes可能就不是一次式生成的（尽管依然是主理想），所以就可能不存在本征值。此外，对于无限维的情况，此时$\ann(V)$可以为零，所以也可能不存在本征值。

\begin{pro}
    设有限生成$k[x]$-模$V$的极小多项式为$p(V)$，则由于$k[x]$是PID，所以$p(V)$可以唯一分解为一族不可约首一多项式$\{p_i\}$的乘积，即
    \[
        p(V)=p_1^{i_1}\cdots p_k^{i_k},
    \]
    则$A$具有本征值$a$，当且仅当$(x-a)\in \{p_i\}$.
\end{pro}

\begin{proof}
    如果$A$具有本征值$a$，则$\langle x-a\rangle \in \Ass(V)$，其包含$\ann(V)=\langle p(V)\rangle$，因此$p(V)$的分解中必有因子$(x-a)$. 反过来，如果$p(V)$的分解中具有因子$(x-a)$，则$\langle x-a\rangle$是包含$\langle p(V)\rangle =\ann(V)$的一个极小素理想，由于$V$是有限生成的，Lemma \ref{lem:3.5.28} 告诉我们$\supp(V)$由所有包含$\ann(V)$的素理想构成，继而Proposition \ref{pro:5.1.9} 立刻告诉我们，$\langle x-a\rangle \in \Ass(V)$.
\end{proof}

\begin{pro}
    如果$V$是有限维矢量空间，则$\deg(p(V))\leq \dim (V)$. 特别地，$A$的本征值数目不大于$V$的维数。
\end{pro}

\begin{proof}
    依然是Hamilton-Cayley定理Theorem \ref{Hamilton-Cayley}，因为$V$可以由$\dim V$个元素生成，所以$\ann(V)=\langle p(V)\rangle$包含一个最高次数为$\dim V$的多项式，这就给出了$\deg(p(V))\leq \dim (V)$. 此外，上一个命题告诉我们，$A$的本征值数目不能超过$\deg(p(V))$.
\end{proof}

\begin{para}[根子空间]
    设$p\in k[x]$是一个多项式，对$k[x]$-模$V$，考虑集合
    \[
        V(p)=\{v\in V\;:\; \text{存在自然数$n$使得$p(x)^nv=0$}\},
    \]
    不难检验，这是$V$的一个$k[x]$-子模（当然也是一个子空间），它被称为$V$的对应于多项式$p$的根子空间。
\end{para}

\begin{lem}\label{lem:6.3.9}
    设$k[x]$-模$V$的极小多项式可以分解为$p(V)=p_1^{n_1}\cdots p_k^{n_m}$，则存在一个$v\in V(p_i)$使得$\ann(v)=\langle p_i^{n_i}\rangle$.
\end{lem}

\begin{proof}
    实际上，我们可以找到一个$v\in V(p_i)$使得$p_i^{n_i-1}(x)v\neq 0$且$p_i^{n_i}(x)v=0$，此时自然有$\ann(v)=\langle p_i^{n_i}\rangle$. 现在，取$w\in V$，则
    \[
        v_w=\left(p_1^{n_1}\cdots p_{i-1}^{n_{i-1}}p_{i+1}^{n_{i+1}}\cdots p_{m}^{n_{m}}\right)(x)w,
    \]
    满足$p_i^{n_i}(x)v_w=0$. 但是，如果对所有的$w\in V$都有$p_i^{n_i-1}(x)v_w=0$，则多项式
    \[
        p_1^{n_1}\cdots p_{i-1}^{n_{i-1}}p_i^{n_i-1}p_{i+1}^{n_{i+1}}\cdots p_{m}^{n_{m}}
    \]
    作用在任意的$w\in V$都为零，所以它处于极小多项式生成的理想中，但他比极小多项式的次数严格小，矛盾。
\end{proof}

\begin{pro}\label{pro:6.3.6}
    设$V$是有限生成$k[x]$-模且极小多项式$p(V)$非零，则存在$v\in V$使得$\ann(v)=\ann(V)$.
\end{pro}

\begin{proof}
    设$p(V)$可以分解为$p(V)=p_1^{n_1}\cdots p_k^{n_m}$，首先，存在$v_i\in V(p_i)$且$\ann(v_i)=\langle p_i^{n_i}\rangle$. 此外，由于分解中的$p_i$都两两互素，所以任意两个$V(p_i)$都只相交于$\{0\}$. 因此，$\{v_i\}$是线性无关的，并且，由于每个$V(p_i)$都是$k[x]$-子模，所以任取$f\in k[x]$，则$\{f(x)v_i\}$中的非零矢量族是线性无关的。

    最后，考虑$v=\sum_i v_i$. 任取$f\in k[x]$使得$\deg f<\deg (p(V))$，则总存在一个$v_i$使得$f(x)v_i\neq 0$，因此$f(x)v\neq 0$，或者说$f\not\in \ann(v)$. 由于$\ann(v)$包含$\ann(V)$非零，所以他由一个多项式$q\in k[x]$生成，如果$\ann(v)$真包含$\ann(V)$，则$\deg q< \deg (p(V))$，所以$q\not\in \ann(v)$，矛盾，所以$\ann(v)=\ann(V)$.
\end{proof}

\begin{pro}\label{pro:6.3.7}
    设$k[x]$-模$V$是一个$n$-维$k$-矢量空间，$p(V)$为其极小多项式，$q(V)$为其本征多项式，则以下命题等价：
    \begin{compactenum}
        \item $\deg(p(V))=\dim V$;
        \item $p(V)=q(V)$;
        \item 存在$v\in V$使得$v$, $xv$, $\dots$, $x^{n-1}v$是线性无关的;
        \item $V$是一个循环$k[x]$-模，即$V$作为$k[x]$-模可以由单个元素生成。
    \end{compactenum}
\end{pro}

\begin{proof}
    其中只有1和3的等价性没那么平凡。如果$\deg(p(V))=\dim V=n$，上一个命题告诉我们，存在一个$v\in V$使得任取$(n-1)$-次多项式$q\in k[x]$都有$q(x)v\neq 0$，而这又意味着$v$, $xv$, $\dots$, $x^{n-1}v$是线性无关的。反过来，如果$v\in V$使得$v$, $xv$, $\dots$, $x^{n-1}v$是线性无关的，考虑$\ann(v)=\langle q\rangle$，其中$\deg q\geq n$. 但同时，因为$\ann(v)$包含$\ann(V)=\langle p(V)\rangle$，所以$\deg q\leq \deg(p(V))$，所以
    \[
        \dim V=n\leq \deg q\leq \deg(p(V)),
    \]
    结合$\deg(p(V))\leq \dim V$，我们就得到了$\deg(p(V))=\dim V$.
\end{proof}

下面我们首先研究循环$k[x]$-模。

\begin{pro}\label{pro:6.3.10}
    设有限维$k$-矢量空间$V$是一个循环$k[x]$-模，极小多项式的分解为$p(V)=p_1^{n_1}\cdots p_m^{n_m}$，则我们有分解
    \[
       V=\bigoplus_i V(p_i),
    \]
    且$\dim_k V(p_i)=n_i\deg(p_i)$. 此外，$V(p_i)$的极小多项式$p(V(p_i))$就是$p_i^{n_i}$，所以$V(p_i)$是一个循环$k[x]$-模。
\end{pro}

\begin{proof}
    从Lemma \ref{lem:6.3.9} 可知$\langle p(V(p_i))\rangle=\ann (V(p_i))\subset \langle p_i^{n_i}\rangle$，所以
    \[n_i\deg(p_i)=\deg (p_i^{n_i})\leq \deg (p(V(p_i))).\]
    同时，$V(p_i)$作为$k[x]$-模，我们有$\deg (p(V(p_i))) \leq \dim V(p_i)$. 所以$n_i\deg(p_i)\leq \dim V(p_i)$. 
    
    另一方向，由于$V$是循环$k[x]$-模，所以$\deg p(V)=\dim V$，故
    \[
        \dim V=\sum_i n_i\deg(p_i)\leq \sum_i\dim V(p_i)\leq \dim V,
    \]
    其中最后一个不等号来自于$\{p_i\}$两两互素，直和$\bigoplus_i V(p_i)\subset \dim V$. 因此直和分解成立。此外，如果有一个$n_i\deg(p_i)$严格小于$\dim V(p_i)$，则这将违背$\dim V=\sum_i n_i$，所以$\dim V(p_i)=n_i\deg(p_i)$.

    最后，因为
    \[
        \deg(p_i^{n_i})\leq \deg (p(V(p_i)))\leq \dim V(p_i),
    \]
    所以从$\dim V(p_i)=n_i\deg(p_i)$以及Proposition \ref{pro:6.3.7} 立刻得到$V(p_i)$是一个循环$k[x]$-模。
\end{proof}

\section{主理想整环上的有限生成模}

在这节中，设$R$是一个主理想整环，而$M$是一个有限生成模。我们首先利用中国剩余定理给出的一个循环$R$-模的刻画。某种角度来看，他是Proposition \ref{pro:6.3.10} 的推广。

\begin{pro}
    设$R$是一个PID，$M$是一个循环$R$-模，且$\ann_R(M)=\langle p_1^{n_1}\cdots p_k^{n_m}\rangle$，其中$p_i$都是$R$中的素元（可以为零），此时，我们有$R$-模同构
    \[
        M\cong \bigoplus_i R/\langle p_i^{n_i}\rangle.
    \]
\end{pro}

\begin{proof}
    对循环$R$-模$M$，则模同态$R\to M$给出了$R$-模同构$M\cong R/\ann(M)$. 此外，由于$\{p_i\}$两两互素，所以中国剩余定理告诉我们，存在环同构
    \[
        R/\langle p_1^{n_1}\cdots p_k^{n_m}\rangle = R/\left(\bigcap_i \langle p_i^{n_i}\rangle\right)\cong \prod_i R/\langle p_i^{n_i}\rangle,
    \]
    这个环同构是商映射族$\pi_i:R\to R/\langle p_i^{n_i}\rangle$的积$\pi=\prod_i \pi_i:R\to \prod_j R/\langle p_i^{n_i}\rangle$的商。如果将两侧看成$R$-模，则作为环同态的$\pi$将给出一个$R$-模同态（正是$\pi_i$给出了$R/\langle p_i^{n_i}\rangle$的$R$-模结构），所以，我们有$R$-模同构
    \[
        M\cong \bigoplus_i R/\langle p_i^{n_i}\rangle
    \]
    此即所需。
\end{proof}

\begin{pro}
	如果$M$是有限生成自由$R$-模，则$M$的子模也是一个自由$R$-模。
\end{pro}

一般地，如果$R$不是PID，则这个命题未必成立。

\begin{proof}
	首先，可以设$M=R^n$. 然后对子模的$\rank$做归纳。对于$\rank(M)=1$的情况，此时$M$可以看成$R$，则$M$的子模对应于$R$的理想$\langle a\rangle$，同时由于$\ann_R (a)=0$，所以是一个自由模。

	现在假设命题对于$k<n$的情况都正确。任取$R^n$的子模$S$，设 $S_1$是所有形如$(s_1,\dots,s_{n-1},0)$的元素的集合，以及$S_2$是所有形如$(0,\dots,0,s_n)$的元素的集合与$S$的交。显然，$S_1$同构于$R^{n-1}$的一个子模，归纳假设告诉我们这是自由的，所以设$\{\alpha_1,\dots,\alpha_k\}$是$S_1$的一组自由基。类似地，$S_2$同构于$R$的一个理想，如果$S_2$平凡，则$S=S_1$自由，否则$\rank S_2=1$，设基为$\{\beta=(0,\dots,0,t_n)\}$，这里$(t_1,\dots,t_n)\in S$. 

	最后，我们检查$\{\alpha_1,\dots,\alpha_k,\beta\}$是$S$的基。从最后一个坐标来看，$\beta$与$\{\alpha_1,\dots,\alpha_k\}$线性无关，同时$\{\alpha_1,\dots,\alpha_k\}$作为自由基本身也是线性无关的。然后，任取$\alpha=(s_1,\dots,s_n)\in S$，则存在$r\in R$使得$s_n=rt_n$，所以$\alpha-r\beta\in S_1$，同时$\{\alpha_1,\dots,\alpha_k,\beta\}$生成$S_1$，于是$\{\alpha_1,\dots,\alpha_k,\beta\}$生成$S$.
\end{proof}

\begin{para}[挠元、挠模]
	设$M$是一个$R$-模，如果对$m\in M$有$\ann(m)\neq 0$，则$m$被称为一个挠元。如果$M$中每个元素都是挠元，则$M$被称为一个挠模。如果对非零的$m\in M$都有$\ann(m)=0$，则称$M$是一个无挠模。
\end{para}

对$M$来说，其所有挠元构成的集合是它的一个子模，这被称为$M$的挠子模，记作$M_{\text{tor}}$. 显然，$M$无挠当且仅当$M_{\text{tor}}=0$. 所以，$M/M_{\text{tor}}$总是无挠的。此外，由于模同态$\varphi:M\to N$将挠元映射为挠元，所以他自然诱导了映射$M/M_{\text{tor}}\to N/N_{\text{tor}}$，这体现了$M/M_{\text{tor}}$的函子性。实际上，若$N$是无挠模，则$\operatorname{Hom}_{R}(M/M_{\text{tor}},N)\cong \operatorname{Hom}_{R}(M,N)$，所以这是将无挠性遗忘的遗忘函子的左伴随。

\begin{pro}
	设$R$是一个PID，$M$是一个有限生成无挠模，则$M$是一个自由模。一般地，如果$M$是一个有限生成模，则成立分解
    \[
        M=M_{\mathrm{tor}}\oplus M_{\mathrm{free}}
    \]
    这里$M_{\mathrm{free}}$是一个自由模，其秩只依赖于$M$.
\end{pro}

PID上的自由模当然是无挠的。

\begin{proof}
	我们先考虑无挠的情况，我们选$M$的一个有限生成集合$X$，然后取其中的极大线性无关子集$Y$. 虽然我们未必可以将$x\in X-Y$表为$Y$的线性组合，但是由于$Y\cup \{x\}$线性相关，则存在$r_x\in R$使得$r_xx$可以由$Y$线性组合而成. 令$r=\prod_{x\in X-Y}r_x$，则$m\mapsto rm$给出的映射$M\to \bigoplus_{y\in Y}R$是单射，那么作为自由模的子模，$M$依然是自由模。

    现在，来到一般的模。由于$M/M_{\mathrm{tor}}$是有限生成无挠模，所以是自由的。我们可以选一组基，然后找$M$中的原像，然后给出其生成的子模，容易验证这是一个自由子模，且与$M_{\mathrm{tor}}$无交。
\end{proof}

\begin{para}[根子模]
    设$r\in R$，对$R$-模$M$，局部化同态$\alpha_r:M\to M_r$的核$\ker \alpha_r$被称为$M$关于$r$的根子模，记作$M(r)$. 不难看到，
    \[
        M(r)=\{m\in V\;:\; \text{存在自然数$n$使得$r^nv=0$}\}.
    \]
\end{para}

\begin{lem}
    如果$r$和$s$互素，则$M(r)\cap M(s)=\{0\}$.
\end{lem}

\begin{proof}
    取$m\in M(r)\cap M(s)$，所以存在一个足够大的$n$使得$r^nm=0=s^nm$. 如果$r$, $s$生成单位理想，则$r^{n}$和$s^{n}$也生成单位理想\footnote{以素谱的语言，我们知道：如果$\{D(f_i)\}$构成了$\operatorname{Spec} R$的一个开覆盖，当且仅当$\{f_i\}$生成了$R$. 同时，再注意到$D(f)=D(f^n)$对任意的正整数$n$都成立。}，因此存在$a$, $b\in R$使得$ar^{n}+bs^{n}=1$. 乘以$m$后立刻得到$m=0$.
\end{proof}

\begin{lem}
    设$M$是一个$R$-模且$\ann_R(M)=\langle p_1^{n_1}\cdots p_m^{n_m}\rangle \neq 0$，则存在一个$m_i\in M(p_i)$使得$\ann(m_i)=\langle p_i^{n_i}\rangle$，因此$\ann(M(p_i))=\langle p_i^{n_i}\rangle$.
\end{lem}

\begin{proof}
    我们可以找到一个$m_i\in M(p_i)$使得$p_i^{n_i-1}m_i\neq 0$且$p_i^{n_i}m_i=0$，此时自然有$\ann(m_i)=\langle p_i^{n_i}\rangle$. 实际上，此时，$p_i^{n_i}\in \ann(m_i)=\langle q_i\rangle$，所以$p_i^{n_i}=rq_i$，但是根据唯一分解，立刻得到$\langle q_i\rangle=\langle p_i^n\rangle$，其中$n\leq n_i$. 再从$p_i^{n_i-1}m_i\neq 0$，就有$\ann(m_i)=\langle q_i\rangle = \langle p_i^{n_i}\rangle$.
    
    现在，取$w\in M$，则
    \[
        m_w=\left(p_1^{n_1}\cdots p_{i-1}^{n_{i-1}}p_{i+1}^{n_{i+1}}\cdots p_{m}^{n_{m}}\right)w,
    \]
    满足$p_i^{n_i}m_w=0$. 但是，如果对所有的$m\in M$都有$p_i^{n_i-1}m_w=0$，则$R$中的元素
    \[
        p_1^{n_1}\cdots p_{i-1}^{n_{i-1}}p_i^{n_i-1}p_{i+1}^{n_{i+1}}\cdots p_{m}^{n_{m}}
    \]
    作用在任意的$m\in M$都为零，所以它处于极小多项式生成的理想中，这与唯一分解性质矛盾。

    最后，欲证$\ann(M(p_i))=\langle p_i^{n_i}\rangle$，现在只需说明任取$m\in M(p_i)$，我们都有$p_i^{n_i}m=0$. 这从零因子的分解是显然的。
\end{proof}

作为推论，我们有$\Ass(M(p_i))=\{\langle p_i\rangle\}$，如果存在$M$的一个子模$N$使得$M/N\cong M(p_i)$，此时$N$就是一个$\langle p_i\rangle$-准素子模，后面我们会具体构造出这个子模$N$.

\begin{pro}
    设$R$-模$M$是一个挠模，存在$m\in M$使得$\ann(m)=\ann(M)$.
\end{pro}

\begin{proof}
    设$\ann_R(M)=\langle p_1^{n_1}\cdots p_k^{n_m}\rangle$，根据上一个引理，存在$m_i\in M(p_i)$且$\ann(m_i)=\langle p_i^{n_i}\rangle$. 此外，由于分解中的$p_i$都两两互素\footnote{因为主理想整环的非零素理想是极大理想，所以两个不同的素元互素。}，所以任意两个$M(p_i)$都只相交于$\{0\}$. 由于每个$M(p_i)$都是$k[x]$-子模，所以任取$r\in R$，则$rm_i$依然在$M(p_i)$中。

    最后，考虑$m=\sum_i m_i$. 由于$\ann(M)\subset \ann(m)=\langle q\rangle$，所以$p_1^{n_1}\cdots p_k^{n_m}=qr$，其中$r\in R$，于是唯一分解告诉我们
    \[
        \ann(m)=\langle p_1^{l_1}\cdots p_k^{l_m}\rangle,
    \]
    其中$l_i\leq n_i$. 由于$\ann(m_i)=\langle p_i^{n_i}\rangle$，将$p_1^{l_1}\cdots p_k^{l_m}$作用到$m_i$上，除非$l_i=n_i$，否则不为零，因此，只有当$l_i=n_i$对所有的$i$都成立时，$p_1^{l_1}\cdots p_k^{l_m}$乘以$m$才为零，此即$\ann(m)=\ann(M)$.
\end{proof}

\begin{pro}
    设$M$是一个有限生成$R$-模且$\ann_R(M)=\langle p_1^{n_1}\cdots p_k^{n_k}\rangle \neq 0$，则
    \[
        M=M(p_1)\oplus \cdots  \oplus M(p_k).
    \]
\end{pro}

\begin{proof}
    任取$m\in M$，由于$\ann_RM\subset \ann_R m=\langle q\rangle$，所以，可以设
    \[
        q=p_1^{l_1}\cdots p_k^{l_k},
    \]
    其中$l_i\leq n_i$. 现在，构造
    \[
    	q_i=p_1^{l_1}\cdots \widehat{p_i^{l_i}}\cdots p_k^{l_k},
    \]
    我们下面证明存在$r_i$使得$\sum_i r_iq_i=1$. 实际上，逐级下降即可，降到$k=2$的时候是平凡的，因为$\{p_i^{l_i}\}$两两互素。比方说，从$k$开始，此时存在$r$, $s$使得$rp_{k}^{l_{k}}+sp_i^{l_i}=1$，所以从
    \[
    q_i=p_1^{l_1}\cdots \widehat{p_i^{l_i}}\cdots p_k^{l_k} \quad\text{和}\quad q_{k}=p_1^{l_1}\cdots p_{k-1}^{l_{k-1}}
    \]
    可以构造出
    \[
    p_1^{l_1}\cdots \widehat{p_i^{l_i}}\cdots p_{k-1}^{l_{k-1}}=rq_i+sq_{k}.
    \]

    最后，注意到$m_i=q_im\in M(p_i)$，所以
    \[
    m=\sum_i r_iq_im=\sum_i r_im_i\in M(p_1)\oplus \cdots  \oplus M(p_k),
    \]
    此即所证。
\end{proof}

现在，我们来考察有限生成挠模$M$的准素子模。

\begin{pro}
    设$M$是一个有限生成$R$-模且$\ann_R(M)=\langle p_1^{n_1}\cdots p_m^{n_m}\rangle \neq 0$，则$\Ass_RM=\{\langle p_1\rangle ,\dots,\langle p_m\rangle \}$.
\end{pro}

\begin{proof}
    显然，$\{\langle p_1\rangle ,\dots,\langle p_m\rangle \}\subset \Ass_RM$，因为每个$\langle p_i\rangle$都是包含$\ann_R(M)$的极小素理想，见Proposition \ref{pro:5.1.9}. 所以，我们只需证明不存在其他的associated primes. 如果$\ann(m)=\langle q\rangle$是一个素理想，由于$\ann(M)\subset \ann(m)$，所以$p_1^{n_1}\cdots p_m^{n_m}=qr$，其中$r\in R$. 根据唯一分解，$q$只能等于某个$p_i$.
\end{proof}

 \begin{pro}
    设$M$是一个有限生成$R$-模且$\ann_R(M)=\langle p_1^{n_1}\cdots p_m^{n_m}\rangle \neq 0$，从而局部化映射$M\to M_{\langle p_i\rangle}$的核给出了$\langle p_i\rangle$-准素子模$M_i$，且$\bigcap_{i}M_i=\{0\}$.
\end{pro}

\begin{proof}
    前一个论断就是Proposition \ref{pro:5.2.13}，我们只需证明$\bigcap_{i}M_i=\{0\}$. 取$m\in \bigcap_{i}M_i$，所以存在$r_i\not\in \langle p_i\rangle$使得$r_im=0$. 因为$\ann(M)\subset \ann(m)$，所以可设$\ann(m)=\langle p_1^{l_1}\cdots p_m^{l_m}\rangle$. 从$r_i\not\in \langle p_i\rangle$，立刻得到$l_i=0$，所以$\ann(m)=R$，继而$m=0$.
\end{proof}

此时，可以看到$\bigcap_i M_i=\{0\}$就是$\{0\}$的极小分解了，从而利用Theorem \ref{thm:5.2.17} 给出了如下推论。

\begin{coro}
设$M$是一个有限生成$R$-挠模，且$\ann_R(M)=\langle p_1^{n_1}\cdots p_k^{n_k}\rangle \neq 0$，则$N_i=M(p_1)\oplus \cdots \oplus \widehat{M(p_i)}\oplus \cdots  \oplus M(p_k)$是$M$的一个$\langle p_i\rangle$-准素子模，且$N_i=\ker(\alpha_i)$，这里$\alpha_i:M\to M_{\langle p_i\rangle}$是典范的局部化同态。
\end{coro}

\begin{proof}
    只需注意到$\Ass(M/N_i)=\Ass(M(p_i))=\{\langle p_i\rangle\}$以及$\bigcap_i N_i=\{0\}$即可。
\end{proof}

但这并没有给出所有的$\langle p_i\rangle$-准素子模。如果$M(p_i)$存在直和分解$M(p_i)=M'\oplus M''$，则我们有$\Ass(M')=\Ass(M'')=\Ass(M(p_i))$，此时
\[
    N_i\oplus M'\quad \text{和}\quad  N_i\oplus M'',
\]
都是$\langle p_i\rangle$-准素子模。但是，从某种角度而言，我们给出了“极小的”准素子模们。

\begin{para}
迄今为止，给定一个有限生成$R$-模，则我们有分解
\[
    M=M_{\mathrm{free}}\oplus M_{\mathrm{tor}},
\]
并且对挠模$M_{\mathrm{tor}}$，如果$\ann(M_{\mathrm{tor}})=\langle p_1^{n_1}\cdots p_k^{n_k}\rangle$，我们有分解
\[
    M_{\mathrm{tor}}=M(p_1)\oplus \cdots  \oplus M(p_k),
\]
所以我们有分解
\[
    M=M_{\mathrm{free}}\oplus M(p_1)\oplus \cdots  \oplus M(p_k).
\]
\end{para}

最后，我们来分解$M(p_i)$，注意到$\ann(M(p_i))=\langle p_i^{n_i}\rangle$，而$p_i$是一个素元。

\begin{pro}
设$M$是一个$R$-挠模且$\ann(M)=\langle p^n\rangle$，其中$p\in R$是一个素元，则$M$可以写成几个循环$R$-模的直和。
\end{pro}

显然，这些循环模$M_i$都有$\ann(M_i):=p^{n_i}$，其中$n_i\leq n$，于是他们同构于$R/\langle p^{n_i}\rangle$.

\begin{proof}
我们用归纳法，对$M$的极小生成集的元素个数归纳。首先，如果$M$的极小生成集的个数为$1$，则已经是循环模了。现在假设小于$r$的时候都对，设$M$的极小生成集为$\{x_1,\dots,x_r\}$，再记$\ann(x_i)=\langle p^{n_i}\rangle$且满足$n_1\geq n_2\geq \cdots\geq n_r$，我们还需要选取使得$n_r$在不同的极小生成集的选取中是极小的。取$\{x_1,\dots,x_{r-1}\}$生成的子模$N$，由归纳假设，它可以由某个极小生成集$\{y_1,\dots,y_{l}\}$自由生成，由于极小性，必然有$l\leq r-1$. 但是，由于$\{y_1,\dots,y_{l},x_r\}$生成了$M$，所以再由极小性，$l=r-1$. 我们下面将$x_i$取做$y_i$，其中$1\leq i\leq r-1$.

下面我们证明$M=N\oplus Rx_r$，即证明$N\cap Rx_r=\{0\}$. 为此，考虑商模$M/N$，$\bar x_r$为$x_r$的像，此时有$\ann(\bar x_r)=\langle p^k\rangle$，我们只需证明$k=n_r$. 实际上，如果这是对的，则任取$z\in N\cap Rx_r$，都有$d\in R$使得$z=dx_r$，从而$d\in \ann(\bar x_r)=\langle p^k\rangle=\langle p^{n_r}\rangle$，于是$z=dx_r=0$. 

由于$n_r\geq k$，我们只要排除严格大于的情况。此时，由于$p^k x_r\in N$，所以存在直和分解$p^k x_r=\sum_{i=1}^{r-1} a_i x_i$. 乘以$p^{n_r-k}$之后，可以得到$p^{n_r}x=\sum_i a_ip^{n_r-k} x_i=0$，进而$a_ip^{n_r-k}x_i=0$对每个$1\leq i\leq r-1$都对。于是，$a_ip^{n_r-k}\in \langle p^{n_i}\rangle$，因为$n_r$的极小性，$a_i\in \langle p^k\rangle$，所以可以记$a_i=p^kb_i$. 最后令$x_r'=x_r-\sum_{i=1}^{r-1} b_ix_i$，可以看到$p^kx_{r}'=0$，这与$n_r$的极小性矛盾。
\end{proof}

于是，对任意的有限生成模$M$，如果$\ann(M_{\mathrm{tor}})=\langle p_1^{n_1}\cdots p_k^{n_k}\rangle$，则其可以分解为
\[
    M\cong R^r\oplus \bigoplus_{i=1}^k\bigoplus_{j=1}^{n_i} (R/\langle p_i^{j}\rangle)^{m_{ij}}.
\]
为了计算$m_{ij}$，我们只需在域$R/\langle p_i\rangle$上计算所有的$\dim (p_i^kM/p_i^{k+1}M)$即可。实际上，我们先计算$R/\langle p_1\rangle$上的$\dim (M/p_1M)$，注意到对$p_i\neq p_1$，我们都有
\[
    \dim_{R/\langle p_1\rangle}R/\langle p_i^{j}\rangle/\langle p_1\rangle=0,
\]
这是因为互素，$p_i$在$R/\langle p_1\rangle$中的像可逆，导致模掉$p_i$就模光了。同时
\[
    \dim_{R/\langle p_1\rangle}R/\langle p_1^{j}\rangle/\langle p_1\rangle=\dim_{R/\langle p_1\rangle}R/\langle p_1\rangle=1,
\]
所以
\[
    \dim_{R/\langle p_1\rangle}(M/p_1M)=r+\sum_{j=1}^{n_1}m_{1j}.
\]
同样的理由，可以计算得到
\[
    \dim_{R/\langle p_1\rangle}(p_1^2M/p_1M)=r+\sum_{j=1}^{n_1-1}m_{1j}.
\]
于是我们可以一路得到所有的$m_{1j}$和$r$，其他的$m_{ij}$也同理。这就说明了上面的分解的唯一性。

\begin{thm}
    主理想整环$R$上的有限生成模$M$都同构如
    \[
        M\cong R^r\oplus\bigoplus_{i=1}^n R/\mathfrak{a}_i,
    \]
    其中$0\neq \mathfrak{a}_n\subset \mathfrak{a}_{n-1}\subset \cdots\subset\mathfrak{a}_1\neq R$，且此真理想链由$M$的同构类唯一确定，称为$M$的初等因子。
\end{thm}

\begin{proof}
    如果$\ann(M_{\mathrm{tor}})=\langle p_1^{n_1}\cdots p_k^{n_k}\rangle$，且在上述分解中我们已经得到了$m_{ij}$，即我们有$m_{ij}$个$p_i^j$. 现在，对每个$i$，取最大的$p_i^j$，并相应修改我们的$m_{ij}$，然后考虑其乘积，他生成的理想记作$\mathfrak{a}_n$. 我们只需对新的$m_{ij}$持续做下去，就得到了所需的全部的理想。并且，不难看到$n=\max_i(\sum_j m_{ij})$.
\end{proof}

作为一个直接的应用，我们考虑域的乘法群的有限子群，他们只能是循环群。

\begin{pro}
    设$k$是域，乘法群$k^\times = k-\{0\}$的任何有限子群都是循环群。特别地，如果$k$是有限域，则$k^\times$是循环群。
\end{pro}

\begin{proof}
    如果$A\subset k^\times$是有限群，则作为交换群，即$\mathbb Z$-模，利用PID上的有限生成模的分解定理，有
    \[
        A\cong \bigoplus_{i=1}^n \mathbb Z/\langle d_i\rangle,
    \]
    其中$d_1|d_2|\cdots|d_n$，注意到这里没有自由模，否则不有限。于是，可以看到任取$\{a\in A\,:\, a^{d_n}=1\}$共有$\prod_i d_i$个元素。然而多项式$x^{d_n}-1$在$k$中至多只有$d_n$个根，于是只可能$n=1$，所以$A$是一个循环群。
\end{proof}